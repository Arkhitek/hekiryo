<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æœ¨é€ è»¸çµ„ã¿å·¥æ³•ç”¨å£é‡ãƒ»ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ  (Full Ver)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
/* --- æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ« --- */
.arkhitek-logo-top { position: absolute; top: 20px; right: 30px; width: 120px; height: auto; z-index: 100; }
.arkhitek-logo-bottom { display: block; margin: 40px auto 0 auto; width: 120px; height: auto; }
@media print { .arkhitek-logo-top { position: fixed; top: 10mm; right: 10mm; width: 100px; } .arkhitek-logo-bottom { margin-top: 20mm; width: 100px; } }
:root { --primary:#2c3e50; --bg:#f5f7fa; --panel:#fff; --ok:#27ae60; --ng:#c0392b; --border:#ccc; --link:#3498db; }
* { box-sizing: border-box; }
body{font-family:"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;background:var(--bg);color:#333;margin:0;padding:20px;}
.container{max-width:1000px;margin:0 auto;background:var(--panel);padding:24px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.05);}
h1{text-align:center;color:var(--primary);margin:0 0 8px 0;font-size:1.4rem;}
.subtitle{text-align:center;color:#7f8c8d;margin-bottom:10px;font-size:0.9rem;font-weight:bold;}
/* Header Tools */
.tools-bar { display:flex; justify-content:flex-end; gap:10px; margin-bottom:15px; background:#eef2f7; padding:10px; border-radius:6px; }
.tool-btn { font-size:0.85rem; padding:6px 12px; border:1px solid #ccc; background:#fff; cursor:pointer; border-radius:4px; display:flex; align-items:center; gap:5px; }
.tool-btn:hover { background:#f0f0f0; border-color:#999; }
.tool-btn svg { width:14px; height:14px; fill:#555; }

/* Grid & Layout */
.cols-2{display:grid;grid-template-columns:1fr 1fr;gap:30px;}
@media(max-width:768px){.cols-2{grid-template-columns:1fr;}}
.row{margin-bottom:12px;}
label{display:block;font-weight:700;font-size:0.85rem;color:#444;margin-bottom:6px;}
input[type=number],select,input[type=text]{width:100%;padding:8px;border:1px solid var(--border);border-radius:4px;}
/* Result Cards */
.res-card{background:#fff;border:2px solid var(--primary);padding:12px;border-radius:6px;text-align:center;}
.res-val{font-size:1.6rem;font-weight:700;color:var(--primary);}
.res-sub{font-size:0.85rem;color:#666;margin-top:8px;}
/* Tables */
.check-table{width:100%;border-collapse:collapse;font-size:0.9rem;margin-top:10px;}
.check-table th, .check-table td{border:1px solid #ddd;padding:8px;text-align:center;background:#fff;}
.status-ok{color:var(--ok);font-weight:700;background:#e8f5e9;}
.status-ng{color:var(--ng);font-weight:700;background:#fdecea;}
/* Log Style */
.detail-box{background:#2c3e50;color:#ecf0f1;padding:16px;border-radius:8px;margin-top:30px;font-family:'Courier New', monospace;font-size:0.85rem;line-height:1.4;}
.detail-box h3 {border-bottom:1px solid #95a5a6; padding-bottom:5px; margin-top:0; color:#fff;}
.detail-box h4{color:#f1c40f;margin:15px 0 5px 0;border-left:4px solid #f1c40f;padding-left:8px;}
.log-row{display:flex;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,0.06);padding:4px 0;}
.log-key{color:#bdc3c7; flex:1;}
.log-val{color:#2ecc71;font-weight:700; text-align:right;}
.log-note{font-size:0.75rem;color:#95a5a6;display:block;text-align:right;margin-left:10px;}
.log-formula{color:#3498db; font-size:0.8rem; text-align:right; margin-right:10px; flex:1;}
/* Tabs */
.tabs{display:flex;border-bottom:1px solid #ccc;margin-bottom:16px;overflow-x:auto;}
.tab-btn{padding:8px 14px;cursor:pointer;background:#eee;border:1px solid transparent;border-bottom:none;border-radius:4px 4px 0 0;margin-right:6px;color:#666;white-space:nowrap;}
.tab-btn.active{background:#fff;border-color:#ccc;border-bottom-color:#fff;color:var(--primary);font-weight:700;}
.tab-content{display:none;}
/* Titles inside sections */
.input-group-title {font-size:0.9rem; font-weight:bold; color:var(--primary); border-bottom:1px solid #eee; margin-bottom:10px; padding-bottom:4px; margin-top:10px;}
.section-header { display:none; border-bottom:2px solid #333; margin-top:20px; padding-bottom:5px; margin-bottom:15px; font-size:1.2rem; font-weight:bold; color:#000; }
/* Links & Buttons */
.ref-link-mini { font-size:0.75rem; color:#fff; background:var(--link); padding:2px 6px; border-radius:4px; text-decoration:none; margin-left:auto; }
.footer-link-box { margin-top:30px; padding:15px; background:#eaf2f8; border:1px solid #bdc3c7; border-radius:6px; text-align:center; }
.footer-link-box a { color:var(--link); font-weight:bold; text-decoration:none; font-size:0.95rem; }
.pdf-btn { display:block; width:100%; max-width:300px; margin:20px auto 0; padding:12px; background:#e74c3c; color:#fff; text-align:center; border:none; border-radius:6px; font-weight:bold; font-size:1rem; cursor:pointer; transition:0.3s; }
.pdf-btn:hover { background:#c0392b; }
.action-btn { cursor:pointer; padding:4px 8px; background:#eee; border:1px solid #ccc; border-radius:4px; font-size:0.85rem; }
.select-btn { cursor:pointer; padding:4px 10px; background:#3498db; color:#fff; border:none; border-radius:4px; font-size:0.8rem; margin-left:4px; white-space:nowrap; }
.select-btn:hover { background:#2980b9; }

/* 4-Bunkatsu Styles */
.balance-box { border:1px solid #aaa; background:#fafafa; padding:10px; border-radius:4px; margin-top:10px; }
.balance-result { font-weight:bold; margin-left:10px; }
.zone-btn { 
  padding: 6px 12px; 
  border: 2px solid #bbb; 
  background: #fff; 
  border-radius: 4px; 
  cursor: pointer; 
  font-size: 0.85rem;
  transition: all 0.2s;
}
.zone-btn:hover { background: #e3f2fd; border-color: #2196f3; }
.zone-btn.selected { 
  background: #2196f3; 
  color: #fff; 
  border-color: #1976d2; 
  font-weight: bold;
}



/* Modal & PDF Mode (Same as before) */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
.modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; width: 95%; max-width: 800px; max-height: 90vh; overflow-y: auto; border-radius: 8px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
.modal-close { position: absolute; top: 15px; right: 20px; font-size: 1.8rem; cursor: pointer; color: #aaa; z-index:10; }
.category-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
@media(max-width:600px){ .category-grid { grid-template-columns: 1fr; } }
.cat-btn { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 8px; padding: 20px 10px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
.cat-btn:hover { background: #e2e6ea; border-color: #adb5bd; transform: translateY(-2px); }
.cat-btn strong { font-size: 1.1rem; color: #2c3e50; margin-bottom: 5px; display:block; }
.back-btn { background: #6c757d; color: #fff; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; margin-bottom: 10px; }
.ref-image-box { text-align: center; margin-bottom: 20px; padding: 10px; background: #f9f9f9; border: 1px solid #ddd; }
.ref-image-box img { max-width: 100%; max-height: 300px; height: auto; display: block; margin: 0 auto; }
.spec-table { width:100%; border-collapse:collapse; font-size:0.85rem; }
.spec-table th { background:#2c3e50; color:#fff; padding:8px; border:1px solid #ccc; text-align:center; }
.spec-table td { padding:8px; border:1px solid #ccc; cursor:pointer; }
.spec-table tr:hover td { background:#eaf2f8; }
.pdf-break { display: none; }

/* PDFå‡ºåŠ›é …ç›®ãƒã‚§ãƒƒã‚¯ï¼ˆç”»é¢ç”¨ï¼‰ */
.pdf-controls { margin-top: 10px; padding: 12px; background:#eaf2f8; border:1px solid #bdc3c7; border-radius:6px; }
.pdf-controls label { display:inline-flex; align-items:center; gap:6px; margin-right:14px; margin-top:6px; font-size:0.9rem; font-weight:700; color:var(--primary); }
body.pdf-mode { background: #fff !important; padding: 0 !important; margin: 0 !important; width: 100% !important; overflow: visible !important; }
/* PDFã¯A4å¹…ã«åˆã‚ã›ã¦è‡ªå‹•ç¸®å°ºã•ã‚Œã‚‹ã‚ˆã†å›ºå®šå¹…ã‚’ã‚„ã‚ã‚‹ */
body.pdf-mode .container { width: auto !important; max-width: none !important; min-width: 0 !important; padding: 0 !important; margin: 0 !important; border: none !important; box-shadow: none !important; }
body.pdf-mode .cols-2 { gap: 15px !important; }
body.pdf-mode .tabs, body.pdf-mode .pdf-btn, body.pdf-mode .footer-link-box, body.pdf-mode .tab-btn, body.pdf-mode .action-btn, body.pdf-mode .select-btn, body.pdf-mode .modal-overlay, body.pdf-mode .tools-bar { display: none !important; }
body.pdf-mode .tab-content { display: block !important; }
body.pdf-mode .section-header { display: block !important; margin-top: 0 !important; }
body.pdf-mode, body.pdf-mode input, body.pdf-mode select, body.pdf-mode h1, body.pdf-mode label { color: #000 !important; background: transparent !important; }
/* æ—§: pdf-breakã¯ç©ºç™½ãƒšãƒ¼ã‚¸ã®åŸå› ã«ãªã‚Šã‚„ã™ã„ãŸã‚PDFã§ã¯ç„¡åŠ¹åŒ– */
body.pdf-mode .pdf-break { display: none !important; }

/* PDFå†…ã§ã®è¡¨ç¤ºåˆ¶å¾¡ */
body.pdf-mode .pdf-controls { display: none !important; }
body.pdf-mode .pdf-hide { display: none !important; }

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½ã®æ”¹ãƒšãƒ¼ã‚¸ */
body.pdf-mode .pdf-page-break { page-break-before: always !important; break-before: page !important; }
/* ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãƒšãƒ¼ã‚¸ã‚’ã¾ãŸã’ãšåˆ‡ã‚Œã‚‹å•é¡Œã‚’é¿ã‘ã‚‹ãŸã‚ã€ãƒ†ãƒ¼ãƒ–ãƒ«è‡ªä½“ã¯åˆ†å‰²å¯ã€è¡Œã¯åˆ†å‰²ä¸å¯ */
body.pdf-mode table { page-break-inside: auto; break-inside: auto; }
body.pdf-mode tr { page-break-inside: avoid; break-inside: avoid; }

/* ã‚«ãƒ¼ãƒ‰ã¯ãƒšãƒ¼ã‚¸å†…ã«åã‚ã‚‹ */
body.pdf-mode .res-card { page-break-inside: avoid; break-inside: avoid; }

/* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ©ãƒƒãƒ‘ãƒ¼ã¯PDFã§ã¯ç„¡åŠ¹ï¼ˆåˆ‡ã‚Œã®åŸå› ï¼‰ */
body.pdf-mode .table-scroll { overflow: visible !important; }

/* å…¥åŠ›æ¬„ã¯PDFã§å°‘ã—ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
body.pdf-mode input, body.pdf-mode select { font-size: 10px !important; padding: 2px 4px !important; }
body.pdf-mode label { font-size: 10px !important; }
body.pdf-mode .detail-box { page-break-inside: auto; background: #fff !important; color: #000 !important; border: 1px solid #000 !important; padding: 10px !important; margin-top: 10px !important; }

/* 1. å¿…è¦å£é‡ã®ç®—å‡ºï¼š1ãƒšãƒ¼ã‚¸å†…ã«åã‚ã‚‹ãŸã‚PDFæ™‚ã¯è©°ã‚ã‚‹ */
body.pdf-mode #wall .cols-2 { gap: 10px !important; }
body.pdf-mode #wall .row { margin-bottom: 6px !important; }
body.pdf-mode #wall .input-group-title { margin-top: 8px !important; margin-bottom: 6px !important; padding-bottom: 2px !important; }
body.pdf-mode #wall h3 { margin-top: 8px !important; margin-bottom: 6px !important; font-size: 12px !important; }
body.pdf-mode #wall .res-card { padding: 8px !important; }
body.pdf-mode #wall .res-sub { margin-top: 2px !important; font-size: 9px !important; }
body.pdf-mode #wall #disp_lw1,
body.pdf-mode #wall #disp_lw2 { font-size: 1.8rem !important; }

/* ã‚¹ãƒãƒ›è¡¨ç¤ºæ™‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
.table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 10px; }
</style>
</head>
<body style="position:relative;">
<a href="https://arkhitek.co.jp/" target="_blank" rel="noopener">
  <img src="arkhitek_logo.png" alt="ARKHITEK Logo" class="arkhitek-logo-top" />
</a>
<div class="container" id="main-container">
  <div class="tools-bar">
    <button class="tool-btn" onclick="DataMgr.saveToBrowser()">ğŸ’¾ ãƒ–ãƒ©ã‚¦ã‚¶ä¿å­˜</button>
    <button class="tool-btn" onclick="DataMgr.loadFromBrowser()">ğŸ“‚ ç¶šãã‹ã‚‰</button>
    <span style="border-right:1px solid #ccc; margin:0 5px;"></span>
    <button class="tool-btn" onclick="DataMgr.exportJSON()">â¬‡ JSONä¿å­˜</button>
    <button class="tool-btn" onclick="document.getElementById('file-import').click()">â¬† JSONèª­è¾¼</button>
    <input type="file" id="file-import" style="display:none;" accept=".json" onchange="DataMgr.importJSON(this)">
  </div>

  <h1>æœ¨é€ è»¸çµ„ã¿å·¥æ³•ç”¨å£é‡ãƒ»ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ </h1>
  <p class="subtitle">ä»¤å’Œ7å¹´åŸºæº–ãƒ»åœ°éœ‡/é¢¨åœ§ãƒ»å››åˆ†å‰²å¯¾å¿œ</p>

  <div class="tabs" id="tab-controls">
    <div class="tab-btn active" onclick="switchTab('wall', this)">1. å¿…è¦å£é‡ã®ç®—å‡º</div>
    <div class="tab-btn" onclick="switchTab('wallcheck', this)">2. å£é‡/ãƒãƒ©ãƒ³ã‚¹</div>
    <div class="tab-btn" onclick="switchTab('column', this)">3. æŸ±ã®æ–­é¢ç®—å®š</div>
  </div>

  <div id="wall" class="tab-content" style="display:block;">
    <div class="section-header">1. å¿…è¦å£é‡ã®ç®—å‡º</div>
    <div class="cols-2">
      <div>
        <div class="input-group-title">åŸºæœ¬æ¡ä»¶</div>
        <div class="row">
          <label>éšæ•°</label>
          <select id="stories" onchange="UI.update(); Calc.exec();">
            <option value="2">2éšå»ºã¦</option>
            <option value="1">å¹³å±‹å»ºã¦</option>
          </select>
        </div>
        <div class="row">
          <label>ç”¨é€” (ç©è¼‰è·é‡)</label>
          <select id="usage" onchange="Calc.exec()">
            <option value="res">ä½å®… (P=600/1300)</option>
            <option value="office">äº‹å‹™æ‰€ (P=800/1800)</option>
          </select>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div class="row">
            <label>æ€§èƒ½ç­‰ç´š</label>
            <select id="grade" onchange="Calc.exec()">
              <option value="1">ç­‰ç´š1 (åŸºæº–æ³•)</option>
              <option value="2">ç­‰ç´š2 (1.25å€)</option>
              <option value="3">ç­‰ç´š3 (1.50å€)</option>
            </select>
          </div>
          <div class="row">
            <label>åœ°åŸŸä¿‚æ•° Z</label>
            <select id="z_val" onchange="Calc.exec()">
              <option value="1.0">1.0</option>
              <option value="0.9">0.9</option>
              <option value="0.8">0.8</option>
              <option value="0.7">0.7</option>
            </select>
          </div>
        </div>

        <div class="input-group-title" style="margin-top:15px;">å»ºç‰©è¦æ¨¡</div>
        <div class="row" id="grp_h2"><label>2éš éšé«˜ (m)</label><input type="number" id="h2" value="2.8" step="0.01" onchange="Calc.exec()"></div>
        <div class="row"><label>1éš éšé«˜ (m)</label><input type="number" id="h1" value="2.8" step="0.01" onchange="Calc.exec()"></div>
        <div class="row"><label>å±‹æ ¹é«˜ã• (æœ€é«˜é«˜ã•-è»’é«˜) (m)</label><input type="number" id="roof_h" value="1.5" step="0.1" onchange="Calc.exec()"></div>
        <div class="row" id="grp_area2"><label>2éš åºŠé¢ç© (ã¡)</label><input type="number" id="area2" value="50" step="0.01" onchange="Calc.exec()"></div>
        <div class="row"><label>1éš åºŠé¢ç© (ã¡)</label><input type="number" id="area1" value="50" step="0.01" onchange="Calc.exec()"></div>
      </div>

      <div>
        <div class="input-group-title">ä»•æ§˜ãƒ»è·é‡</div>
        <div class="row"><label>å±‹æ ¹ä»•æ§˜</label>
          <select id="mat_roof" onchange="Calc.exec()">
            <option value="990">ç“¦å±‹æ ¹ (990 N/ã¡)</option>
            <option value="740">ã‚¹ãƒ¬ãƒ¼ãƒˆ (740 N/ã¡)</option>
            <option value="500">é‡‘å±æ¿ (500 N/ã¡)</option>
          </select>
        </div>
        
        <div class="row">
          <label>å¤šé›ªåŒºåŸŸ</label>
          <select id="is_heavy_snow" onchange="UI.toggle('snow'); Calc.exec();">
            <option value="no">ãªã— (ä¸€èˆ¬åŒºåŸŸ)</option>
            <option value="yes">ã‚ã‚Š (å¤šé›ªåŒºåŸŸ)</option>
          </select>
        </div>
        <div id="pnl_snow" style="display:none;grid-template-columns:1fr 1fr;gap:8px;">
          <div class="row"><label>å‚ç›´ç©é›ªé‡ (cm)</label><input type="number" id="val_snow_d" value="50" onchange="Calc.exec()"></div>
          <div class="row"><label>å˜ä½è·é‡ N/mÂ²/cm</label><input type="number" id="val_snow_w" value="30" onchange="Calc.exec()"></div>
        </div>

        <div class="row">
          <label>å¤ªé™½å…‰ãƒ‘ãƒãƒ«</label>
          <select id="mat_solar" onchange="Calc.exec();">
            <option value="0">ãªã—</option>
            <option value="200">ã‚ã‚Š (200 N/ã¡)</option>
          </select>
        </div>

        <div class="row"><label>å¤–å£ä»•æ§˜</label>
          <select id="mat_wall" onchange="Calc.exec()">
            <option value="åœŸå¡—ã‚Šå£ç­‰">åœŸå¡—ã‚Šå£ (1000)</option>
            <option value="ãƒ¢ãƒ«ã‚¿ãƒ«ç­‰">ãƒ¢ãƒ«ã‚¿ãƒ« (890)</option>
            <option value="ã‚µã‚¤ãƒ‡ã‚£ãƒ³ã‚°">ã‚µã‚¤ãƒ‡ã‚£ãƒ³ã‚° (600)</option>
            <option value="é‡‘å±æ¿å¼µ">é‡‘å±æ¿å¼µ (500)</option>
            <option value="ä¸‹è¦‹æ¿å¼µ">ä¸‹è¦‹æ¿å¼µ (350)</option>
          </select>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div class="row"><label>å±‹æ ¹å‹¾é…(å¯¸)</label><input type="number" id="kobai" value="4" onchange="Calc.exec()"></div>
          <div class="row"><label>è»’ã®å‡º (m)</label><input type="number" id="noki" value="0.6" step="0.1" onchange="Calc.exec()"></div>
        </div>
      </div>
    </div>

    <h3 style="margin-top:16px;">è¨ˆç®—çµæœ</h3>
      <div class="cols-2">
        <div>
          <div class="res-card" style="padding-top:18px;">
            <div style="font-size:1.1rem;font-weight:bold;color:#e74c3c;margin-bottom:2px;">1éš å¿…è¦å£é‡ (cm/ã¡)</div>
            <div class="res-val" id="disp_lw1" style="font-size:2.2rem;color:#e74c3c;">-</div>
            <div class="res-sub" style="margin-top:2px;">â€»å°æ•°ç‚¹ä»¥ä¸‹åˆ‡ã‚Šä¸Šã’</div>
            <div class="res-sub">æ”¯ãˆã‚‹é‡é‡ Î£W1: <span id="disp_sw1">-</span> kN / Ai: 1.00</div>
          </div>
        </div>
        <div id="res_card_2f">
          <div class="res-card" style="padding-top:18px;">
            <div style="font-size:1.1rem;font-weight:bold;color:#3498db;margin-bottom:2px;">2éš å¿…è¦å£é‡ (cm/ã¡)</div>
            <div class="res-val" id="disp_lw2" style="font-size:2.2rem;color:#3498db;">-</div>
            <div class="res-sub" style="margin-top:2px;">â€»å°æ•°ç‚¹ä»¥ä¸‹åˆ‡ã‚Šä¸Šã’</div>
            <div class="res-sub">æ”¯ãˆã‚‹é‡é‡ Î£W2: <span id="disp_sw2">-</span> kN / Ai: <span id="disp_ai2">-</span></div>
          </div>
        </div>
      </div>
  </div>

  <div class="pdf-break"></div>

  <div id="column" class="tab-content" style="display:none;">
    <div class="section-header">3. æŸ±ã®æ–­é¢ç®—å®š</div>
    <div class="cols-2">
      <div>
        <div class="input-group-title">æŸ±ã®æ¤œè¨æ¡ä»¶</div>
        <div class="row">
          <label>æ¤œè¨éš</label>
          <select id="col_floor" onchange="Calc.exec()">
            <option value="1">1éšã®æŸ±</option>
            <option value="2" id="opt_col_2f">2éšã®æŸ±</option>
          </select>
        </div>
        <div class="row">
          <label>è² æ‹…éƒ¨ä½</label>
          <select id="col_pos" onchange="Calc.exec()">
            <option value="outer">å¤–å‘¨éƒ¨ (å±‹æ ¹+å¤–å£)</option>
            <option value="inner">å†…éƒ¨ (å±‹æ ¹+å†…å£)</option>
          </select>
        </div>
        <div class="row">
          <div style="display:flex;justify-content:space-between;align-items:center;">
             <label style="margin:0;">è² æ‹…é¢ç© (ã¡)</label>
             <a href="https://www.howtec.or.jp/relays/download/441/1513/1313/5775/?file=/files/libs/5775/202405241338047322.pdf" target="_blank" class="ref-link-mini">å‚è€ƒè³‡æ–™</a>
          </div>
          <input type="number" id="col_ae" value="5.0" step="0.1" onchange="Calc.exec()" style="margin-top:6px;">
        </div>
        
        <div class="input-group-title" style="margin-top:15px;">æŸ±ã®ä»•æ§˜</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div class="row"><label>çŸ­è¾º (mm)</label><input type="number" id="col_w_min" value="105" onchange="Calc.exec()"></div>
          <div class="row"><label>é•·è¾º (mm)</label><input type="number" id="col_w_max" value="105" onchange="Calc.exec()"></div>
        </div>
        <div class="row"><label>æç¨®ãƒ»åŒºåˆ†</label><select id="mat_cat" onchange="Mat.updateSpecies()"></select></div>
        <div class="row"><label>æ¨¹ç¨®è©³ç´°</label><select id="mat_spec" onchange="Mat.updateGrade()"></select></div>
        <div class="row"><label>ç­‰ç´šé¸æŠ</label><select id="mat_grade" onchange="Calc.exec()"></select></div>
        <div class="row" style="background:#f9f9f9;padding:10px;border-radius:4px;">
          <label>é¸æŠã•ã‚ŒãŸåŸºæº–å¼·åº¦ Fc</label>
          <strong id="disp_fc" style="color:var(--primary);font-size:1.2rem;">-</strong> N/ãŸ
        </div>
      </div>

      <div>
        <div class="input-group-title">æ¤œå®šçµæœ</div>
        <div class="res-card" style="border-color:#3498db;background:#f4faff;">
          <div class="res-val" id="col_judge">-</div>
          <div class="res-sub" id="col_msg">-</div>
        </div>

        <div class="table-scroll">
          <table class="check-table">
            <tr><th>é …ç›®</th><th>è¨ˆç®—å€¤</th><th>åŸºæº–/è¨±å®¹</th></tr>
            <tr><td>åºŠé¢ç©ã‚ãŸã‚Šè·é‡</td><td><span id="chk_wd">-</span> N/ã¡</td><td>(å¹³å‡è·é‡æ³•)</td></tr>
            <tr><td>ç™ºç”Ÿè»¸åŠ› (N)</td><td><span id="chk_n_act">-</span> kN</td><td><span id="chk_n_allow">-</span> kN</td></tr>
            <tr><td>æœ‰åŠ¹ç´°é•·æ¯” (Î»)</td><td id="chk_lambda">-</td><td>â‰¦ 150</td></tr>
            <tr><td>é•·æœŸè¨±å®¹å¿œåŠ›åº¦ (fk)</td><td><span id="chk_fk">-</span> N/ãŸ</td><td>1.1/3 Ã— Fc Ã— Kd</td></tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="pdf-break"></div>

  <div id="wallcheck" class="tab-content" style="display:none;">
    <div class="section-header" style="display:block;">2. å£é‡å……è¶³ãƒ»ãƒãƒ©ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯</div>
    
    <!-- é¢¨åœ§åŠ›ã®æ¤œè¨ (ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¡¨ç¤ºåˆ‡æ›¿) -->
    <div style="background:#fff3e0; padding:15px; border-radius:8px; border:1px solid #ffcc80; margin-bottom:20px;">
      <label style="font-weight:bold;cursor:pointer;color:#e65100;display:flex;align-items:center;gap:8px;">
        <input type="checkbox" id="chk_wind_check" onchange="WallCheck.toggleWind()">
        é¢¨åœ§åŠ›ã®æ¤œè¨ã‚’è¡Œã†
      </label>
      <div id="pnl_wind_check" style="display:none;margin-top:10px;">
        <div class="row"><label>é¢¨åœ§åŠ›ä¿‚æ•° (ä¸€èˆ¬50/å¼·é¢¨70)</label><input type="number" id="wind_coeff" value="50" onchange="Calc.exec(); WallCheck.recalcFloor('1f'); WallCheck.recalcFloor('2f');"></div>
        <div id="grp_wind_2f" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;background:#fffde7;padding:8px;border-radius:4px;margin-bottom:8px;">
          <div class="row"><label>2Fè¦‹ä»˜ X(ã¡)</label><input type="number" id="wind_aw_x2" value="20" placeholder="åºŠé¢+1.35mä»¥ä¸Š" step="0.1" onchange="Calc.exec(); WallCheck.recalcFloor('2f');"></div>
          <div class="row"><label>2Fè¦‹ä»˜ Y(ã¡)</label><input type="number" id="wind_aw_y2" value="15" placeholder="åºŠé¢+1.35mä»¥ä¸Š" step="0.1" onchange="Calc.exec(); WallCheck.recalcFloor('2f');"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;background:#fffde7;padding:8px;border-radius:4px;margin-bottom:8px;">
          <div class="row"><label>1Fè¦‹ä»˜ X(ã¡)</label><input type="number" id="wind_aw_x1" value="25" placeholder="åºŠé¢+1.35mä»¥ä¸Š" step="0.1" onchange="Calc.exec(); WallCheck.recalcFloor('1f');"></div>
          <div class="row"><label>1Fè¦‹ä»˜ Y(ã¡)</label><input type="number" id="wind_aw_y1" value="20" placeholder="åºŠé¢+1.35mä»¥ä¸Š" step="0.1" onchange="Calc.exec(); WallCheck.recalcFloor('1f');"></div>
        </div>
        <p style="font-size:0.8rem; color:#666; margin:4px 0 0 0;">â€»è¦‹ä»˜é¢ç©ã¯åºŠé¢+1.35mä»¥ä¸Šã®éƒ¨åˆ†ã®å‚ç›´æŠ•å½±é¢ç©</p>
      </div>
    </div>

    <!-- å››åˆ†å‰²æ³•ã®èª¬æ˜ (ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¡¨ç¤ºåˆ‡æ›¿) -->
    <div style="background:#e8f5e9; padding:15px; border-radius:8px; border:1px solid #a5d6a7; margin-bottom:20px;">
      <label style="font-weight:bold;cursor:pointer;color:#2e7d32;display:flex;align-items:center;gap:8px;">
        <input type="checkbox" id="chk_4div_check" onchange="WallCheck.toggle4Div()">
        å››åˆ†å‰²æ³•ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ã‚’è¡Œã†
      </label>
      <div id="pnl_4div_explain" style="display:none;margin-top:10px;">
        <img src="4bunkatsu.png" alt="å››åˆ†å‰²æ³•èª¬æ˜å›³" style="max-width:100%;border:1px solid #ccc;border-radius:4px;">
        <div style="font-size:0.85rem;color:#555;margin-top:8px;background:#f5f5f5;padding:10px;border-radius:4px;">
          <p style="margin:0 0 5px 0;"><strong>ã€åˆ¤å®šåŸºæº–ã€‘</strong></p>
          <p style="margin:0 0 3px 0;">â‘  å£é‡å……è¶³ç‡ï¼ˆå­˜åœ¨å£é‡Ã·å¿…è¦å£é‡ï¼‰ï¼ 1.0 â†’ <span style="color:green;font-weight:bold;">OK</span></p>
          <p style="margin:0 0 3px 0;">â‘¡ å……è¶³ç‡ãŒ1.0ä»¥ä¸‹ã®å ´åˆï¼šå£ç‡æ¯”ï¼ˆå°Ã·å¤§ï¼‰â‰§ 0.5 â†’ <span style="color:green;font-weight:bold;">OK</span></p>
          <p style="margin:5px 0 0 0;font-size:0.8em;color:#888;">â€»1/4å´ç«¯éƒ¨åˆ†ã®å¿…è¦å£é‡ = å…¨ä½“å¿…è¦å£é‡ Ã— 0.25</p>
        </div>
      </div>
    </div>

    <div id="wc_area_1f" style="margin-bottom:30px; border-bottom:2px dashed #ccc; padding-bottom:20px;">
      <h3 style="background:#eee; padding:8px; border-left:5px solid #e74c3c;">1éšã®åˆ¤å®š</h3>

      <!-- å£é‡ç·é‡ å……è¶³ãƒã‚§ãƒƒã‚¯çµæœ -->
      <div id="wc_summary_1f" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;">
        <div style="background:linear-gradient(135deg,#fff5f5,#ffe5e5);padding:15px;border-radius:8px;border:2px solid #e74c3c;text-align:center;">
          <div style="font-size:0.9rem;color:#666;">Xæ–¹å‘ å£é‡å……è¶³</div>
          <div style="font-size:1.5rem;font-weight:bold;margin:5px 0;">
            <span id="wc_exist_x_1f">-</span> / <span id="wc_req_disp_x_1f">-</span> cm
          </div>
          <div id="wc_judge_x_1f" style="display:inline-block;padding:4px 16px;border-radius:20px;font-weight:bold;font-size:1.1rem;">-</div>
        </div>
        <div style="background:linear-gradient(135deg,#fff5f5,#ffe5e5);padding:15px;border-radius:8px;border:2px solid #e74c3c;text-align:center;">
          <div style="font-size:0.9rem;color:#666;">Yæ–¹å‘ å£é‡å……è¶³</div>
          <div style="font-size:1.5rem;font-weight:bold;margin:5px 0;">
            <span id="wc_exist_y_1f">-</span> / <span id="wc_req_disp_y_1f">-</span> cm
          </div>
          <div id="wc_judge_y_1f" style="display:inline-block;padding:4px 16px;border-radius:20px;font-weight:bold;font-size:1.1rem;">-</div>
        </div>
      </div>
      <!-- éè¡¨ç¤ºã®å¿…è¦å£é‡(è¨ˆç®—ç”¨) -->
      <input type="hidden" id="wc_req_total_x_1f" value="0">
      <input type="hidden" id="wc_req_total_y_1f" value="0">

      <div style="margin-bottom:20px;">
        <div style="font-weight:bold;margin-bottom:4px;">1éš Xæ–¹å‘ (ä¸Šç«¯ãƒ»ä¸‹ç«¯)</div>
        <div class="table-scroll">
          <table id="wc_table_x_1f" style="width:100%;border-collapse:collapse;">
            <thead><tr style="background:#f2f6fb;"><th>é€šã‚Š</th><th>ä»•æ§˜</th><th>å€ç‡</th><th>é•·ã•(m)</th><th>æ•°</th><th>å£é‡</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <button class="action-btn" onclick="WallCheck.addRow('x','1f')">ï¼‹ è¡Œã‚’è¿½åŠ </button>
        
        <!-- å››åˆ†å‰²æ³• Xæ–¹å‘ 1éš -->
        <div id="pnl_4div_x_1f" class="balance-box" style="display:none;margin-top:10px;">
          <strong>â—†å››åˆ†å‰²æ³•ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ (Xæ–¹å‘)</strong>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:8px;">
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">ä¸Šç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_x_1f_t" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('x','1f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_x_1f_t">-</strong> cm</div>
              <div id="wc_4sel_x_1f_t" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_x_1f_t">0</strong> cm</div>
              <div id="res_4bal_x_1f_l" class="balance-result" style="margin-top:5px;">-</div>
            </div>
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">ä¸‹ç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_x_1f_b" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('x','1f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_x_1f_b">-</strong> cm</div>
              <div id="wc_4sel_x_1f_b" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_x_1f_b">0</strong> cm</div>
              <div id="res_4bal_x_1f_r" class="balance-result" style="margin-top:5px;">-</div>
            </div>
          </div>
        </div>
      </div>
      
      <div style="margin-bottom:20px;">
        <div style="font-weight:bold;margin-bottom:4px;">1éš Yæ–¹å‘ (å·¦ç«¯ãƒ»å³ç«¯)</div>
        <div class="table-scroll">
          <table id="wc_table_y_1f" style="width:100%;border-collapse:collapse;">
             <thead><tr style="background:#fff6f8;"><th>é€šã‚Š</th><th>ä»•æ§˜</th><th>å€ç‡</th><th>é•·ã•(m)</th><th>æ•°</th><th>å£é‡</th><th></th></tr></thead>
             <tbody></tbody>
          </table>
        </div>
        <button class="action-btn" onclick="WallCheck.addRow('y','1f')">ï¼‹ è¡Œã‚’è¿½åŠ </button>
        
        <!-- å››åˆ†å‰²æ³• Yæ–¹å‘ 1éš -->
        <div id="pnl_4div_y_1f" class="balance-box" style="display:none;margin-top:10px;">
          <strong>â—†å››åˆ†å‰²æ³•ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ (Yæ–¹å‘)</strong>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:8px;">
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">å·¦ç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_y_1f_l" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('y','1f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_y_1f_l">-</strong> cm</div>
              <div id="wc_4sel_y_1f_l" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_y_1f_l">0</strong> cm</div>
              <div id="res_4bal_y_1f_l" class="balance-result" style="margin-top:5px;">-</div>
            </div>
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">å³ç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_y_1f_r" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('y','1f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_y_1f_r">-</strong> cm</div>
              <div id="wc_4sel_y_1f_r" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_y_1f_r">0</strong> cm</div>
              <div id="res_4bal_y_1f_r" class="balance-result" style="margin-top:5px;">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="pdf-page-break"></div>
    <div id="wc_area_2f">
       <h3 style="background:#eee; padding:8px; border-left:5px solid #3498db;">2éšã®åˆ¤å®š</h3>
       
       <!-- å£é‡ç·é‡ å……è¶³ãƒã‚§ãƒƒã‚¯çµæœ 2F -->
       <div id="wc_summary_2f" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;">
        <div style="background:linear-gradient(135deg,#f0f7ff,#dbeeff);padding:15px;border-radius:8px;border:2px solid #3498db;text-align:center;">
          <div style="font-size:0.9rem;color:#666;">Xæ–¹å‘ å£é‡å……è¶³</div>
          <div style="font-size:1.5rem;font-weight:bold;margin:5px 0;">
            <span id="wc_exist_x_2f">-</span> / <span id="wc_req_disp_x_2f">-</span> cm
          </div>
          <div id="wc_judge_x_2f" style="display:inline-block;padding:4px 16px;border-radius:20px;font-weight:bold;font-size:1.1rem;">-</div>
        </div>
        <div style="background:linear-gradient(135deg,#f0f7ff,#dbeeff);padding:15px;border-radius:8px;border:2px solid #3498db;text-align:center;">
          <div style="font-size:0.9rem;color:#666;">Yæ–¹å‘ å£é‡å……è¶³</div>
          <div style="font-size:1.5rem;font-weight:bold;margin:5px 0;">
            <span id="wc_exist_y_2f">-</span> / <span id="wc_req_disp_y_2f">-</span> cm
          </div>
          <div id="wc_judge_y_2f" style="display:inline-block;padding:4px 16px;border-radius:20px;font-weight:bold;font-size:1.1rem;">-</div>
        </div>
      </div>
      <input type="hidden" id="wc_req_total_x_2f" value="0">
      <input type="hidden" id="wc_req_total_y_2f" value="0">

       <div style="margin-bottom:20px;">
        <div style="font-weight:bold;margin-bottom:4px;">2éš Xæ–¹å‘ (ä¸Šç«¯ãƒ»ä¸‹ç«¯)</div>
        <div class="table-scroll">
          <table id="wc_table_x_2f" style="width:100%;border-collapse:collapse;">
            <thead><tr style="background:#f2f6fb;"><th>é€šã‚Š</th><th>ä»•æ§˜</th><th>å€ç‡</th><th>é•·ã•(m)</th><th>æ•°</th><th>å£é‡</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <button class="action-btn" onclick="WallCheck.addRow('x','2f')">ï¼‹ è¡Œã‚’è¿½åŠ </button>
        
        <div id="pnl_4div_x_2f" class="balance-box" style="display:none;margin-top:10px;">
          <strong>â—†å››åˆ†å‰²æ³•ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ (Xæ–¹å‘)</strong>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:8px;">
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">ä¸Šç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_x_2f_t" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('x','2f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_x_2f_t">-</strong> cm</div>
              <div id="wc_4sel_x_2f_t" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_x_2f_t">0</strong> cm</div>
              <div id="res_4bal_x_2f_l" class="balance-result" style="margin-top:5px;">-</div>
            </div>
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">ä¸‹ç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_x_2f_b" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('x','2f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_x_2f_b">-</strong> cm</div>
              <div id="wc_4sel_x_2f_b" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_x_2f_b">0</strong> cm</div>
              <div id="res_4bal_x_2f_r" class="balance-result" style="margin-top:5px;">-</div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-bottom:20px;">
        <div style="font-weight:bold;margin-bottom:4px;">2éš Yæ–¹å‘ (å·¦ç«¯ãƒ»å³ç«¯)</div>
        <div class="table-scroll">
          <table id="wc_table_y_2f" style="width:100%;border-collapse:collapse;">
            <thead><tr style="background:#fff6f8;"><th>é€šã‚Š</th><th>ä»•æ§˜</th><th>å€ç‡</th><th>é•·ã•(m)</th><th>æ•°</th><th>å£é‡</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <button class="action-btn" onclick="WallCheck.addRow('y','2f')">ï¼‹ è¡Œã‚’è¿½åŠ </button>
        
        <div id="pnl_4div_y_2f" class="balance-box" style="display:none;margin-top:10px;">
          <strong>â—†å››åˆ†å‰²æ³•ãƒãƒ©ãƒ³ã‚¹æ¤œè¨ (Yæ–¹å‘)</strong>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:8px;">
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">å·¦ç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_y_2f_l" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('y','2f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_y_2f_l">-</strong> cm</div>
              <div id="wc_4sel_y_2f_l" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_y_2f_l">0</strong> cm</div>
              <div id="res_4bal_y_2f_l" class="balance-result" style="margin-top:5px;">-</div>
            </div>
            <div style="background:#f9f9f9;padding:10px;border-radius:6px;">
              <label style="font-weight:bold;">å³ç«¯1/4ã‚¾ãƒ¼ãƒ³</label>
              <div style="font-size:0.85rem;margin:5px 0;">1/4åºŠé¢ç©: <input type="number" id="wc_4area_y_2f_r" value="12.5" step="0.01" style="width:70px;text-align:right;" onchange="this.dataset.userModified='1'; WallCheck.recalc4DivCheck('y','2f')"> ã¡</div>
              <div style="font-size:0.85rem;color:#666;">å¿…è¦å£é‡: <strong id="wc_4req_y_2f_r">-</strong> cm</div>
              <div id="wc_4sel_y_2f_r" style="display:flex;flex-wrap:wrap;gap:5px;margin:8px 0;"></div>
              <div>å­˜åœ¨å£é‡: <strong id="wc_4sum_y_2f_r">0</strong> cm</div>
              <div id="res_4bal_y_2f_r" class="balance-result" style="margin-top:5px;">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pdf-break"></div>



  <div class="pdf-break"></div>
  <div class="detail-box" id="calc_log"></div>
  <div class="footer-link-box">
    <a href="https://www.howtec.or.jp/publics/index/441/" target="_blank">å‚è€ƒè³‡æ–™ï¼šå£é‡ç­‰ã®åŸºæº–ï¼ˆä»¤å’Œï¼—å¹´æ–½è¡Œï¼‰è¨­è¨ˆæ”¯æ´ãƒ„ãƒ¼ãƒ«</a>
  </div>

  <div class="pdf-controls" id="pdf-controls">
    <div style="font-weight:bold; color:var(--primary); margin-bottom:6px;">PDFå‡ºåŠ›é …ç›®</div>
    <label><input type="checkbox" id="pdf_out_wall" checked> 1. å¿…è¦å£é‡ã®ç®—å‡º</label>
    <label><input type="checkbox" id="pdf_out_wallcheck" checked> 2. å£é‡/ãƒãƒ©ãƒ³ã‚¹</label>
    <label><input type="checkbox" id="pdf_out_column" checked> 3. æŸ±ã®æ–­é¢ç®—å®š</label>
    <label><input type="checkbox" id="pdf_out_log" checked> è¨ˆç®—ãƒ­ã‚°</label>
    <div style="font-size:0.8rem; color:#666; margin-top:6px;">â€»ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ãŸé …ç›®ã¯PDFã«å‡ºåŠ›ã—ã¾ã›ã‚“ã€‚</div>
  </div>

  <button class="pdf-btn" onclick="genPDF()" id="btn-export">è¨ˆç®—æ›¸PDFå‡ºåŠ›</button>
</div>

<div id="specModal" class="modal-overlay" onclick="WallCheck.closeModal(event)">
  <div class="modal-content">
    <span class="modal-close" onclick="document.getElementById('specModal').style.display='none'">&times;</span>
    <div id="modal-step1">
      <h3 style="text-align:center;">ä»•æ§˜ã®åˆ†é¡ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
      <p style="text-align:center; color:#666; font-size:0.9rem;">è©²å½“ã™ã‚‹å·¥æ³•ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      <div class="category-grid">
        <button class="cat-btn" onclick="WallCheck.showCategory('okabe')"><strong>å¤§å£ä»•æ§˜</strong><small>æŸ±ãƒ»é–“æŸ±ã®å¤–å´ã«é¢æã‚’å¼µã‚‹</small></button>
        <button class="cat-btn" onclick="WallCheck.showCategory('okabe_floor')"><strong>å¤§å£åºŠå‹ã¡ä»•æ§˜</strong><small>åºŠåˆæ¿ã®ä¸Šã‹ã‚‰é¢æã‚’å¼µã‚‹</small></button>
        <button class="cat-btn" onclick="WallCheck.showCategory('uke')"><strong>å—æä»•æ§˜</strong><small>çœŸå£ãƒ»çœŸå£åºŠå‹ã¡ï¼ˆå—æã‚’ä½¿ç”¨ï¼‰</small></button>
        <button class="cat-btn" onclick="WallCheck.showCategory('sujikai')"><strong>ç­‹äº¤ã„ç­‰</strong><small>æœ¨æç­‹äº¤ã„ãƒ»é‰„ç­‹ç­‹äº¤ã„ç­‰</small></button>
      </div>
    </div>
    <div id="modal-step2" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <button class="back-btn" onclick="WallCheck.backStep1()">Â« åˆ†é¡é¸æŠã«æˆ»ã‚‹</button>
        <h3 id="modal-cat-title" style="margin:0; font-size:1.1rem;"></h3>
      </div>

      <div class="ref-image-box">
        <img id="modal-ref-image" src="" alt="å‚è€ƒè©³ç´°å›³">
        <p style="margin:5px 0 0 0; font-size:0.8rem; color:#666;">â€»å‚è€ƒè©³ç´°å›³ï¼ˆå‡ºå…¸ï¼šå‘Šç¤º1100å·ï¼‰</p>
      </div>

      <div style="overflow-x:auto;">
        <table class="spec-table" id="modal-target-table">
          <thead><tr><th>é¢æã®ç¨®é¡</th><th>é‡˜ãƒ»ã­ã˜</th><th>P1</th><th>P2</th><th>å€ç‡</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <p style="font-size:0.85rem; color:#666; margin-top:8px;">â€»è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨åæ˜ ã•ã‚Œã¾ã™ã€‚</p>
    </div>
  </div>
</div>

<script>
/* ===== Core & Utils ===== */
const val = id => { const el = document.getElementById(id); if(!el) return 0; const v = parseFloat(el.value); return isNaN(v) ? 0 : v; };
const txt = (id, v) => { const el = document.getElementById(id); if(el) el.textContent = v; };
const roundup_to_10 = x => Math.ceil(x / 10.0) * 10.0;
window.switchTab = function(id, btnElement) {
  document.querySelectorAll('.tab-content').forEach(el => el.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
  if(btnElement) btnElement.classList.add('active');
  if(id === 'wallcheck' && window.WallCheck) WallCheck.syncFromCalc();
};

/* ===== PDF ===== */
function genPDF() {
  if (typeof html2pdf === 'undefined') { alert("PDFç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã—"); return; }
  const c = document.getElementById('main-container');
  const b = document.getElementById('btn-export');

  const sections = [
    { key: 'wall', el: document.getElementById('wall'), chk: document.getElementById('pdf_out_wall') },
    { key: 'wallcheck', el: document.getElementById('wallcheck'), chk: document.getElementById('pdf_out_wallcheck') },
    { key: 'column', el: document.getElementById('column'), chk: document.getElementById('pdf_out_column') },
    { key: 'log', el: document.getElementById('calc_log'), chk: document.getElementById('pdf_out_log') }
  ];

  const enabled = sections.filter(s => s.el && s.chk && s.chk.checked);
  if (enabled.length === 0) { alert('PDFå‡ºåŠ›é …ç›®ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„'); return; }

  // PDFç”¨ã«è¡¨ç¤º/æ”¹ãƒšãƒ¼ã‚¸ã‚’ã‚»ãƒƒãƒˆï¼ˆå¾Œã§å¿…ãšæˆ»ã™ï¼‰
  sections.forEach(s => {
    if (!s.el) return;
    s.el.classList.remove('pdf-hide');
    s.el.classList.remove('pdf-page-break');
  });

  enabled.forEach((s, idx) => {
    if (!s.el) return;
    if (idx > 0) s.el.classList.add('pdf-page-break');
  });

  sections.forEach(s => {
    if (!s.el || !s.chk) return;
    if (!s.chk.checked) s.el.classList.add('pdf-hide');
  });

  document.body.classList.add('pdf-mode');
  b.textContent = "ç”Ÿæˆä¸­...";
  html2pdf()
    .set({
      margin: 8,
      filename: 'calc.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: {
        scale: 2,
        useCORS: true,
        scrollX: 0,
        scrollY: 0,
        windowWidth: Math.max(document.documentElement.scrollWidth, c.scrollWidth)
      },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
      pagebreak: {
        mode: ['css'],
        before: '.pdf-page-break'
      }
    })
    .from(c)
    .save()
    .then(() => {
      document.body.classList.remove('pdf-mode');
      b.textContent = "è¨ˆç®—æ›¸PDFå‡ºåŠ›";
      // è¡¨ç¤º/æ”¹ãƒšãƒ¼ã‚¸ã‚’å…ƒã«æˆ»ã™
      sections.forEach(s => {
        if (!s.el) return;
        s.el.classList.remove('pdf-hide');
        s.el.classList.remove('pdf-page-break');
      });
    })
    .catch(e => {
      console.error(e);
      document.body.classList.remove('pdf-mode');
      b.textContent = "è¨ˆç®—æ›¸PDFå‡ºåŠ›";
      sections.forEach(s => {
        if (!s.el) return;
        s.el.classList.remove('pdf-hide');
        s.el.classList.remove('pdf-page-break');
      });
    });
}

/* ===== Data Manager (Pro Version - Fixed for X/Y) ===== */
/* ===== Data Manager (Pro Version - Fixed for X/Y) ===== */
const DataMgr = {
  collect() {
    const inputs = {};
    document.querySelectorAll('input:not(.wc_rowname):not(.wc_ratio):not(.wc_len):not(.wc_count):not([class^="n-"]), select:not(.n-floor-sel):not(.n-pos-sel)').forEach(el => {
       if(el.id) inputs[el.id] = el.value;
    });

    const tables = { x_1f:[], y_1f:[], x_2f:[], y_2f:[] };
    ['x_1f','y_1f','x_2f','y_2f'].forEach(k => {
       const tb = document.getElementById(`wc_table_${k}`);
       if(tb) {
         tb.querySelectorAll('tbody tr').forEach(tr => {
           tables[k].push({
             name: tr.querySelector('.wc_rowname').value,
             spec: tr.querySelector('.wc_name').value,
             ratio: tr.querySelector('.wc_ratio').value,
             len: tr.querySelector('.wc_len').value,
             count: tr.querySelector('.wc_count').value
           });
         });
       }
    });

    const n_rows = [];
    // Nå€¤è¨ˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿åé›†ï¼ˆã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
    const nTable = document.getElementById('n_table');
    if (nTable) {
        nTable.querySelectorAll('tbody tr').forEach(tr => {
           n_rows.push({
              name: tr.querySelector('input[type=text]').value,
              floor: tr.querySelector('.n-floor-sel').value,
              pos: tr.querySelector('.n-pos-sel').value,
              ux1: tr.querySelector('.n-ux1').value, ux2: tr.querySelector('.n-ux2').value,
              uy1: tr.querySelector('.n-uy1').value, uy2: tr.querySelector('.n-uy2').value,
              lx1: tr.querySelector('.n-lx1').value, lx2: tr.querySelector('.n-lx2').value,
              ly1: tr.querySelector('.n-ly1').value, ly2: tr.querySelector('.n-ly2').value
           });
        });
    }
    return { inputs, tables, n_rows };
  },
  apply(data) {
    if(!data) return;
    if(data.inputs) {
      Object.keys(data.inputs).forEach(id => {
        const el = document.getElementById(id);
        if(el) el.value = data.inputs[id];
      });
    }
    if(data.tables) {
       ['x_1f','y_1f','x_2f','y_2f'].forEach(k => {
         const tb = document.getElementById(`wc_table_${k}`);
         if(tb) {
             const tbody = tb.getElementsByTagName('tbody')[0];
             tbody.innerHTML = '';
             if(data.tables[k]) data.tables[k].forEach(r => WallCheck.addRow(k.split('_')[0], k.split('_')[1], r));
         }
       });
    }
    
    // Nå€¤è¨ˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«ã¨NCalcãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿é©ç”¨ï¼ˆã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
    const nTable = document.getElementById('n_table');
    if(nTable && typeof NCalc !== 'undefined') {
      const n_tb = nTable.getElementsByTagName('tbody')[0];
      n_tb.innerHTML = '';
      if(data.n_rows) {
        data.n_rows.forEach(r => NCalc.addRow(r));
      } else {
        NCalc.addRow(); 
      }
    }

    if(typeof Mat !== 'undefined') Mat.init();
    UI.update(); Calc.exec(); 
    if(typeof WallCheck !== 'undefined' && WallCheck.initDone) WallCheck.syncFromCalc();
  },
  saveToBrowser() { localStorage.setItem('ark_calc_v5', JSON.stringify(this.collect())); alert('ä¿å­˜ã—ã¾ã—ãŸ'); },
  loadFromBrowser() { const d=localStorage.getItem('ark_calc_v5'); if(d){this.apply(JSON.parse(d));alert('èª­è¾¼å®Œäº†');}else{alert('ãƒ‡ãƒ¼ã‚¿ãªã—');} },
  exportJSON() {
    const b = new Blob([JSON.stringify(this.collect(),null,2)],{type:'application/json'});
    const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download='calc_data.json'; a.click();
  },
  importJSON(input) {
    const f=input.files[0]; if(!f)return;
    const r=new FileReader(); r.onload=e=>{try{this.apply(JSON.parse(e.target.result));alert('èª­è¾¼å®Œäº†');}catch(x){alert('Error: ' + x);}}; r.readAsText(f);
  }
};

/* ===== Logic Modules ===== */
const DB_SOURCE = {
  "JASæ©Ÿæ¢°ç­‰ç´šåŒºåˆ†": {
    "ã‚ã‹ã¾ã¤": { "E70":9.6, "E90":16.8, "E110":24.6, "E130":31.8, "E150":39 },
    "ã¹ã„ã¾ã¤": { "E70":9.6, "E90":16.8, "E110":24.6, "E130":31.8, "E150":39 },
    "ãƒ€ãƒ•ãƒªã‚«ã‹ã‚‰ã¾ã¤": { "E70":9.6, "E90":16.8, "E110":24.6, "E130":31.8, "E150":39 },
    "ã¹ã„ã¤ãŒ": { "E70":9.6, "E90":16.8, "E110":24.6, "E130":31.8, "E150":39 },
    "ãˆãã¾ã¤": { "E70":9.6, "E90":16.8, "E110":24.6, "E130":31.8, "E150":39 },
    "ã¨ã©ã¾ã¤": { "E70":9.6, "E90":16.8, "E110":24.6, "E130":31.8, "E150":39 },
    "ã‹ã‚‰ã¾ã¤": { "E50":11.4, "E70":18, "E90":24.6, "E110":31.2, "E130":37.8, "E150":44.4 },
    "ã²ã®ã": { "E50":11.4, "E70":18, "E90":24.6, "E110":31.2, "E130":37.8, "E150":44.4 },
    "ã²ã°": { "E50":11.4, "E70":18, "E90":24.6, "E110":31.2, "E130":37.8, "E150":44.4 },
    "ã™ã": { "E50":19.2, "E70":23.4, "E90":28.2, "E110":32.4, "E130":37.2, "E150":41.4 }
  },
  "JASç›®è¦–ç­‰ç´šåŒºåˆ†": {
    "ã‚ã‹ã¾ã¤": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":27, "äºŒç´š":16.8, "ä¸‰ç´š":11.4 },
    "ã¹ã„ã¾ã¤": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":27, "äºŒç´š":18, "ä¸‰ç´š":13.8 },
    "ã‹ã‚‰ã¾ã¤": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":23.4, "äºŒç´š":20.4, "ä¸‰ç´š":18.6 },
    "ãƒ€ãƒ•ãƒªã‚«ã‹ã‚‰ã¾ã¤": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":28.8, "äºŒç´š":25.2, "ä¸‰ç´š":22.2 },
    "ã²ã°": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":28.2, "äºŒç´š":27.6, "ä¸‰ç´š":23.4 },
    "ã²ã®ã": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":30.6, "äºŒç´š":27, "ä¸‰ç´š":23.4 },
    "ã¹ã„ã¤ãŒ": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":21, "äºŒç´š":21, "ä¸‰ç´š":17.4 },
    "ãˆãã¾ã¤ãƒ»ã¨ã©ã¾ã¤": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":27, "äºŒç´š":22.8, "ä¸‰ç´š":13.8 },
    "ã™ã": { "ä¸€ç´š(ç”²/ä¹™ç¨®)":21.6, "äºŒç´š":20.4, "ä¸‰ç´š":18 }
  },
  "ç„¡ç­‰ç´šæ": {
    "é‡è‘‰æ¨¹": {
      "ã‚ã‹ã¾ã¤":22.2, "ãã‚ã¾ã¤":22.2, "ã¹ã„ã¾ã¤":22.2, "ã‹ã‚‰ã¾ã¤":20.7, 
      "ã²ã°":20.7, "ã²ã®ã":20.7, "ã¹ã„ã²":20.7, "ã¹ã„ã²ã°":20.7,
      "ã¤ãŒ":19.2, "ã¹ã„ã¤ãŒ":19.2, "ã‚‚ã¿":17.7, "ãˆãã¾ã¤":17.7, 
      "ã¨ã©ã¾ã¤":17.7, "ã¹ã«ã¾ã¤":17.7, "ã™ã":17.7, "ã¹ã„ã™ã":17.7, "ã‚¹ãƒ—ãƒ«ãƒ¼ã‚¹":17.7
    },
    "åºƒè‘‰æ¨¹": { "ã‹ã—":27, "ãã‚Š":21, "ãªã‚‰":21, "ã¶ãª":21, "ã‘ã‚„ã":21 }
  },
  "JASé›†æˆæ(åŒä¸€ç­‰ç´š)": {
    "4å±¤ä»¥ä¸Š": {
       "E190-F615":50.3, "E170-F540":44.6, "E150-F465":39.2, "E135-F405":33.4,
       "E120-F375":30.1, "E105-F345":28.1, "E95-F315":26.0, "E85-F300":24.3,
       "E75-F270":22.3, "E65-F255":20.6, "E55-F225":18.6
    },
    "3å±¤": {
       "E190-F555":45.8, "E170-F495":40.5, "E150-F435":35.6, "E135-F375":30.4,
       "E120-F330":27.4, "E105-F300":25.5, "E95-F285":23.6, "E85-F270":22.1,
       "E75-F255":20.3, "E65-F240":18.8, "E55-F225":16.9
    },
    "2å±¤": {
       "E190-F510":45.8, "E170-F450":40.5, "E150-F390":35.6, "E135-F345":30.4,
       "E120-F300":27.4, "E105-F285":25.5, "E95-F270":23.6, "E85-F255":22.1,
       "E75-F240":20.3, "E65-F225":18.8, "E55-F200":16.9
    }
  },
  "JAS_LVL(Aç¨®)": {
    "æ§‹é€ ç”¨å˜æ¿ç©å±¤æ": {
      "180E ç‰¹ç´š":46.8, "180E ä¸€ç´š":45, "180E äºŒç´š":42,
      "160E ç‰¹ç´š":41.4, "160E ä¸€ç´š":40.2, "160E äºŒç´š":37.2,
      "140E ç‰¹ç´š":36, "140E ä¸€ç´š":34.8, "140E äºŒç´š":32.4,
      "120E ç‰¹ç´š":31.2, "120E ä¸€ç´š":30, "120E äºŒç´š":27.6,
      "100E ç‰¹ç´š":25.8, "100E ä¸€ç´š":25.2, "100E äºŒç´š":23.4,
      "80E ç‰¹ç´š":21, "80E ä¸€ç´š":19.8, "80E äºŒç´š":18.6,
      "60E ç‰¹ç´š":15.6, "60E ä¸€ç´š":15, "60E äºŒç´š":13.8
    }
  }
};
const WALL_TABLE = [ {name:'åœŸå¡—ã‚Šå£ç­‰',base:1000}, {name:'ãƒ¢ãƒ«ã‚¿ãƒ«ç­‰',base:890}, {name:'ã‚µã‚¤ãƒ‡ã‚£ãƒ³ã‚°',base:600}, {name:'é‡‘å±æ¿å¼µ',base:500}, {name:'ä¸‹è¦‹æ¿å¼µ',base:350} ];

/* ===== è€åŠ›å£ä»•æ§˜ãƒ‡ãƒ¼ã‚¿ï¼ˆå‘Šç¤º1100å· R7.4.1ï¼‰ ===== */
const SPEC_DATA_OKABE = [
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰", nail:"N50 åˆã¯ NZ50", p1:75, p2:150, ratio:4.3},
  {name:"æ§‹é€ ç”¨MDF", nail:"N50 åˆã¯ NZ50", p1:75, p2:150, ratio:4.3},
  {name:"æ§‹é€ ç”¨åˆæ¿ 9mm", nail:"CN50 åˆã¯ CNZ50", p1:75, p2:150, ratio:3.7},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒãƒ«(OSB) 9mm", nail:"N50 åˆã¯ NZ50", p1:75, p2:150, ratio:3.7},
  {name:"æ§‹é€ ç”¨åˆæ¿ 5mm", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.5, note:"å¤–:7.5mm"},
  {name:"ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰ 12mm", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.5},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.5},
  {name:"æ§‹é€ ç”¨MDF", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.5},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒãƒ«(OSB) 9mm", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.5},
  {name:"ç¡¬è³ªæœ¨ç‰‡ã‚»ãƒ¡ãƒ³ãƒˆæ¿ 12mm", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.0},
  {name:"ãƒãƒ¼ãƒ‰ãƒœãƒ¼ãƒ‰ 5mm", nail:"N50 åˆã¯ NZ50", p1:150, p2:150, ratio:2.0},
  {name:"ç‚­é…¸ãƒã‚°ãƒã‚·ã‚¦ãƒ æ¿ 12mm", nail:"GNF40 åˆã¯ CNC40", p1:150, p2:150, ratio:2.0},
  {name:"ãƒ‘ãƒ«ãƒ—ã‚»ãƒ¡ãƒ³ãƒˆæ¿ 8mm", nail:"GNF40 åˆã¯ CNC40", p1:150, p2:150, ratio:1.5},
  {name:"æ§‹é€ ç”¨çŸ³è†ãƒœãƒ¼ãƒ‰Aç¨® 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.7},
  {name:"æ§‹é€ ç”¨çŸ³è†ãƒœãƒ¼ãƒ‰Bç¨® 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.2},
  {name:"çŸ³è†ãƒœãƒ¼ãƒ‰ 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:0.9},
  {name:"å¼·åŒ–çŸ³è†ãƒœãƒ¼ãƒ‰ 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:0.9},
  {name:"ã‚·ãƒ¼ã‚¸ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ 12mm", nail:"SN40", p1:100, p2:200, ratio:1.0},
  {name:"ãƒ©ã‚¹ã‚·ãƒ¼ãƒˆ ãƒ¡ã‚¿ãƒ«ãƒ©ã‚¹0.6mmä»¥ä¸Š", nail:"N38 åˆã¯ NZ38", p1:150, p2:150, ratio:1.0}
];

const SPEC_DATA_OKABE_FLOOR = [
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰", nail:"N50åˆã¯NZ50", p1:75, p2:150, ratio:4.3, note:"å—æ30x60 M75d120ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨MDF", nail:"N50åˆã¯NZ50", p1:75, p2:150, ratio:4.3, note:"å—æ30x60 M75d120ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨åˆæ¿ 9mm", nail:"CN50åˆã¯CNZ50", p1:75, p2:150, ratio:3.7, note:"å—æ30x60 M75d120ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒãƒ«(OSB) 9mm", nail:"N50åˆã¯NZ50", p1:75, p2:150, ratio:3.7, note:"å—æ30x60 M75d120ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨åˆæ¿ 5mm", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75d200ä»¥ä¸‹ å¤–:7.5mm"},
  {name:"ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰ 12mm", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75d200ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75d200ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨MDF", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75d200ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨çŸ³è†ãƒœãƒ¼ãƒ‰Aç¨® 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.6, note:"å—æ30x40 M75d300ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨çŸ³è†ãƒœãƒ¼ãƒ‰Bç¨® 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.0, note:"å—æ30x40 M75d300ä»¥ä¸‹"},
  {name:"çŸ³è†ãƒœãƒ¼ãƒ‰ 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:0.9, note:"å—æ30x40 M75d300ä»¥ä¸‹"},
  {name:"å¼·åŒ–çŸ³è†ãƒœãƒ¼ãƒ‰ 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:0.9, note:"å—æ30x40 M75d300ä»¥ä¸‹"}
];

const SPEC_DATA_UKE = [
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰", nail:"N50åˆã¯NZ50", p1:75, p2:150, ratio:4.0, note:"å—æ30x60 M75,N275d120ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨MDF", nail:"N50åˆã¯NZ50", p1:75, p2:150, ratio:4.0, note:"å—æ30x60 M75,N275d120ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨åˆæ¿ 9mm", nail:"CN50åˆã¯CNZ50", p1:75, p2:150, ratio:3.3, note:"å—æ30x40 M75,N275d200ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒãƒ«(OSB) 9mm", nail:"N50åˆã¯NZ50", p1:75, p2:150, ratio:3.3, note:"å—æ30x40 M75,N275d200ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨åˆæ¿ 7.5mm", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰ 12mm", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒœãƒ¼ãƒ‰", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨MDF", nail:"N50åˆã¯NZ50", p1:150, p2:150, ratio:2.5, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"çŸ³è†ãƒ©ã‚¹ãƒœãƒ¼ãƒ‰ 9mm", nail:"GNF30,GNC32,WSN,DTSN", p1:150, p2:150, ratio:1.5, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨çŸ³è†ãƒœãƒ¼ãƒ‰Aç¨® 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.5, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"æ§‹é€ ç”¨çŸ³è†ãƒœãƒ¼ãƒ‰Bç¨® 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.3, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"çŸ³è†ãƒœãƒ¼ãƒ‰ 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.0, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"å¼·åŒ–çŸ³è†ãƒœãƒ¼ãƒ‰ 12mm", nail:"GNF40,GNC40,WSN,DTSN", p1:150, p2:150, ratio:1.0, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"},
  {name:"ã‚·ãƒ¼ã‚¸ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ 12mm", nail:"SN40", p1:100, p2:200, ratio:1.0, note:"å—æ30x60 M75,N275d300ä»¥ä¸‹"},
  {name:"ãƒ©ã‚¹ã‚·ãƒ¼ãƒˆ ãƒ¡ã‚¿ãƒ«ãƒ©ã‚¹0.6mmä»¥ä¸Š", nail:"N38 åˆã¯ NZ38", p1:150, p2:150, ratio:1.0, note:"å—æ30x40 M75,N275d300ä»¥ä¸‹"}
];

const SPEC_DATA_SUJIKAI = [
  {name: "åœŸå¡—å£ãƒ»æœ¨ãšã‚Šç­‰ (ç‰‡é¢)", nail: "-", p1: "-", p2: "-", ratio: 0.5},
  {name: "æœ¨ãšã‚Šç­‰ (ä¸¡é¢)", nail: "-", p1: "-", p2: "-", ratio: 1.0},
  {name: "æœ¨æç­‹ã‹ã„ (15x90)", nail: "-", p1: "-", p2: "-", ratio: 1.0},
  {name: "é‰„ç­‹ç­‹ã‹ã„ (Ï†9)", nail: "-", p1: "-", p2: "-", ratio: 1.0},
  {name: "æœ¨æç­‹ã‹ã„ (30x90)", nail: "-", p1: "-", p2: "-", ratio: 1.5},
  {name: "æœ¨æç­‹ã‹ã„ (45x90)", nail: "-", p1: "-", p2: "-", ratio: 2.0},
  {name: "æœ¨æç­‹ã‹ã„ (90è§’)", nail: "-", p1: "-", p2: "-", ratio: 3.0},
  {name: "æœ¨æç­‹ã‹ã„ (15x90)Ã—2 (ãŸã™ãæ›ã‘)", nail: "-", p1: "-", p2: "-", ratio: 2.0},
  {name: "é‰„ç­‹ç­‹ã‹ã„ (Ï†9)Ã—2 (ãŸã™ãæ›ã‘)", nail: "-", p1: "-", p2: "-", ratio: 2.0},
  {name: "æœ¨æç­‹ã‹ã„ (30x90)Ã—2 (ãŸã™ãæ›ã‘)", nail: "-", p1: "-", p2: "-", ratio: 3.0},
  {name: "æœ¨æç­‹ã‹ã„ (45x90)Ã—2 (ãŸã™ãæ›ã‘)", nail: "-", p1: "-", p2: "-", ratio: 4.0},
  {name: "æœ¨æç­‹ã‹ã„ (90è§’)Ã—2 (ãŸã™ãæ›ã‘)", nail: "-", p1: "-", p2: "-", ratio: 5.0}
];

const Mat = {
  init(){
    const catSel = document.getElementById('mat_cat');
    catSel.innerHTML = '';
    Object.keys(DB_SOURCE).forEach(c => {
      const opt = document.createElement('option');
      opt.value = c; opt.textContent = c;
      catSel.appendChild(opt);
    });
    catSel.value = "ç„¡ç­‰ç´šæ";
    this.updateSpecies();
  },
  updateSpecies(){
    const cat = document.getElementById('mat_cat').value;
    const specSel = document.getElementById('mat_spec');
    specSel.innerHTML = '';
    const specs = DB_SOURCE[cat];
    if(!specs) return;
    Object.keys(specs).forEach(s => {
      const opt = document.createElement('option');
      opt.value = s; opt.textContent = s;
      specSel.appendChild(opt);
    });
    if(cat==="ç„¡ç­‰ç´šæ") specSel.value = "é‡è‘‰æ¨¹";
    this.updateGrade();
  },
  updateGrade(){
    const cat = document.getElementById('mat_cat').value;
    const spec = document.getElementById('mat_spec').value;
    const gradeSel = document.getElementById('mat_grade');
    gradeSel.innerHTML = '';
    const grades = DB_SOURCE[cat][spec];
    if (typeof grades === 'object') {
       Object.keys(grades).forEach(g => {
         const fc = grades[g];
         const opt = document.createElement('option');
         opt.value = fc; opt.textContent = `${g} (Fc=${fc})`;
         gradeSel.appendChild(opt);
       });
    }
    if(cat === "ç„¡ç­‰ç´šæ"){
       gradeSel.innerHTML = '';
       const subObj = DB_SOURCE[cat][spec];
       Object.keys(subObj).forEach(treeName => {
         const fc = subObj[treeName];
         const opt = document.createElement('option');
         opt.value = fc; opt.textContent = `${treeName} (Fc=${fc})`;
         if(treeName==='ã™ã') opt.selected = true; 
         gradeSel.appendChild(opt);
       });
    }
    Calc.exec();
  }
};

/* ===== Enhanced Logger ===== */
const Log = {
  lines:[], 
  clear(){this.lines=[]}, 
  header(h){this.lines.push({t:'h',h})}, 
  add(k,v,f,n){this.lines.push({t:'r',k,v,f,n})}, 
  render(){ 
    const box=document.getElementById('calc_log'); 
    box.innerHTML = '<h3>è¨ˆç®—è©³ç´°ãƒ­ã‚°</h3>' + this.lines.map(l=>{ 
      if(l.t==='h') {
        const needsBreak = (typeof l.h === 'string') && l.h.startsWith('6. å¿…è¦å£é‡ã®æ±ºå®š');
        return `${needsBreak ? '<div class="pdf-page-break"></div>' : ''}<h4>${l.h}</h4>`;
      }
      return `<div class="log-row">
        <span class="log-key">${l.k}</span>
        ${l.f ? `<span class="log-formula">${l.f}</span>` : ''}
        <span class="log-val">${l.v}</span>
        ${l.n?` <span class="log-note">${l.n}</span>`:''}
      </div>`; 
    }).join(''); 
  } 
};

/* --- Main Calc (å‚è€ƒãƒ—ãƒ­ã‚°ãƒ©ãƒ æº–æ‹ ) --- */
const Calc = {
  results: { req_1x:0, req_1y:0, req_2x:0, req_2y:0, lw1:0, lw2:0, W1:0, W2:0, Ai2:1.0 },
  exec(){
    Log.clear();
    const stories = parseInt(document.getElementById('stories').value);
    const h1 = val('h1'), h2 = (stories===2) ? val('h2') : 0;
    const area1 = val('area1'), area2 = (stories===2) ? val('area2') : 0;
    const noki = val('noki'), kobai = val('kobai');
    const grade = parseInt(document.getElementById('grade').value);

    // 1. Projection Factor (å±‹æ ¹é¢ç©å€ç‡)
    const base_model_area = 99.0;
    const dim_x = 6.0, dim_y = 16.5;
    const proj_area_model = (dim_x + 2 * noki) * (dim_y + 2 * noki);
    const proj_ratio_model = proj_area_model / base_model_area;
    const slope_factor = Math.sqrt(1 + Math.pow(kobai/10,2));
    const roof_multiplier = proj_ratio_model * slope_factor;

    Log.header("1. å±‹æ ¹ãƒ»å£ã®é‡é‡ç®—å®šä¿‚æ•°");
    Log.add("å±‹æ ¹é¢ç©å€ç‡", roof_multiplier.toFixed(4), `${proj_ratio_model.toFixed(4)} Ã— ${slope_factor.toFixed(4)}`, "æŠ•å½±æ¯”Ã—å‹¾é…");

    // 2. Unit Loads (Roof)
    const w_roof_mat = val('mat_roof');
    const w_roof_insul = 100; // å¤©äº•æ–­ç†±æå›ºå®šå€¤
    const solar_mode = document.getElementById('mat_solar').value;
    const w_solar_surf = (solar_mode === '200') ? 200 : 0;
    const Gr = (w_roof_mat + w_solar_surf) * roof_multiplier + w_roof_insul;

    Log.header("2. å±‹æ ¹è·é‡ã®ç®—å®š (å˜ä½ N/ã¡)");
    Log.add("å±‹æ ¹æ+å¤ªé™½å…‰", (w_roof_mat+w_solar_surf).toFixed(1), `${w_roof_mat}+${w_solar_surf.toFixed(1)}`, "");
    Log.add("å±‹æ ¹è·é‡(Gr)", Gr.toFixed(1), `(${w_roof_mat}+${w_solar_surf.toFixed(1)})Ã—${roof_multiplier.toFixed(4)} + ${w_roof_insul}`, "");

    // Snow
    let Ms = 0;
    const isHeavySnow = (document.getElementById('is_heavy_snow').value === 'yes');
    if(isHeavySnow){
      const d = val('val_snow_d'); 
      const unit = val('val_snow_w'); 
      Ms = (d * unit * 0.35) * proj_ratio_model;
      Log.add("ç©é›ªè·é‡(Ms)", Ms.toFixed(1), `(${d}cmÃ—${unit}Ã—0.35) Ã— ${proj_ratio_model.toFixed(4)}`, "åœ°éœ‡ç”¨(0.35å€)");
    }

    // 3. Wall Loads
    const w_wall_mat_base = WALL_TABLE.find(r=>r.name===document.getElementById('mat_wall').value).base;
    const w_wall_ins_base = 70; // å›ºå®šå€¤
    const w_window_base = 400; 

    const calcOuter = (h) => {
      const perimeter_h = (6*h*2) + (16.5*h*2);
      const floor_A = 99.0;
      const factor_net = (perimeter_h * (1 - 0.09)) / floor_A;
      const factor_win = (perimeter_h * 0.09) / floor_A;
      const t_mat = roundup_to_10(w_wall_mat_base * factor_net);
      const t_ins = roundup_to_10(w_wall_ins_base * factor_net);
      const t_win = roundup_to_10(w_window_base * factor_win);
      return { total: t_mat + t_ins + t_win, t_mat, t_ins, t_win };
    };
    const calcInner = (h) => (200 * h / 2.8);

    Log.header("3. å£è·é‡ã®ç®—å®š (éšé«˜æ¯è¨ˆç®—)");
    let w_wall_2 = 0, w_out2 = 0, w_in2 = 0;
    if(stories===2){
      const out2 = calcOuter(h2);
      w_out2 = out2.total;
      w_in2 = calcInner(h2);
      w_wall_2 = w_out2 + w_in2;
      Log.add("2éšå¤–å£æ¨™æº–", w_out2, `${out2.t_mat}+${out2.t_ins}+${out2.t_win}`, "N/ã¡");
      Log.add("2éšå†…å£æ¨™æº–", w_in2.toFixed(1), `200 Ã— ${h2} / 2.8`, "N/ã¡");
      Log.add("2éšå£è·é‡", w_wall_2.toFixed(1), `${w_out2} + ${w_in2.toFixed(1)}`, "N/ã¡");
    }

    const out1 = calcOuter(h1);
    const w_out1 = out1.total;
    const w_in1 = calcInner(h1);
    const w_wall_1 = w_out1 + w_in1;
    Log.add("1éšå¤–å£æ¨™æº–", w_out1, `${out1.t_mat}+${out1.t_ins}+${out1.t_win}`, "N/ã¡");
    Log.add("1éšå†…å£æ¨™æº–", w_in1.toFixed(1), `200 Ã— ${h1} / 2.8`, "N/ã¡");
    Log.add("1éšå£è·é‡", w_wall_1.toFixed(1), `${w_out1} + ${w_in1.toFixed(1)}`, "N/ã¡");

    // 4. Seismic Weight
    const usage = document.getElementById('usage').value;
    const w_floor_seismic = (usage==='res') ? (610+600) : (610+800);
    
    let W2=0, W1=0, Ai2=1.0;
    const roof_load = Gr + Ms;
    
    Log.header("4. åœ°éœ‡ç”¨é‡é‡(Î£W)ã¨å¿…è¦å£é‡(Lw)");
    
    const Z = (grade>1) ? parseFloat(document.getElementById('z_val').value) : 1.0;
    const gf = (grade===2)?1.25 : (grade===3)?1.5 : 1.0;
    
    let req_lw1 = 0, req_lw2 = 0;
    
    if(stories===2){
      W2 = (roof_load * area2) + (0.5 * w_wall_2 * area2);
      W1 = (w_floor_seismic * area2) + (0.5 * w_wall_2 * area2) + (0.5 * w_wall_1 * area1) + (roof_load * Math.max(0, area1-area2));
      const W2_kN = W2/1000;
      const W1_kN = W1/1000;
      Log.add("2éšé‡é‡ Î£W2", W2_kN.toFixed(2)+" kN", `(å±‹æ ¹+0.5Ã—å£2)Ã—A2`, "");
      Log.add("1éšé‡é‡ Î£W1", W1_kN.toFixed(2)+" kN", `åºŠ+0.5(å£2+å£1)+ä¸‹å±‹`, "");

      // Ai
      const H_total = 0.5 + val('roof_h')/2 + h2 + h1 + 0.5;
      const T = 0.03 * H_total;
      const alpha = W2 / (W1+W2); 
      Ai2 = 1 + ((1/Math.sqrt(alpha)) - alpha) * (2*T)/(1+3*T);
      const C0 = 0.2;
      
      const force2 = W2_kN * Z * Ai2 * C0 * gf;
      req_lw2 = ((force2 / 1.96) * 100) / area2;
      const force1 = (W1_kN + W2_kN) * Z * 1.0 * C0 * gf;
      req_lw1 = ((force1 / 1.96) * 100) / area1;

      Log.add("Ai2 (2éšå±¤ã›ã‚“æ–­åŠ›ä¿‚æ•°)", Ai2.toFixed(3), "", "");
      Log.add("2éš åœ°éœ‡å¿…è¦å£é‡", Math.ceil(req_lw2)+" cm/ã¡", `(${force2.toFixed(2)}kN / 1.96 Ã— 100) / ${area2}ã¡`, "");
      Log.add("1éš åœ°éœ‡å¿…è¦å£é‡", Math.ceil(req_lw1)+" cm/ã¡", `(${force1.toFixed(2)}kN / 1.96 Ã— 100) / ${area1}ã¡`, "");
      
      this.results.W2 = W2_kN;
      this.results.W1 = W1_kN + W2_kN;
      this.results.Ai2 = Ai2;
    } else {
      W1 = (roof_load * area1) + (0.5 * w_wall_1 * area1);
      const W1_kN = W1/1000;
      const force1 = W1_kN * Z * 1.0 * 0.2 * gf;
      req_lw1 = ((force1 / 1.96) * 100) / area1;
      Log.add("1éšé‡é‡ Î£W1", W1_kN.toFixed(2)+" kN", `(å±‹æ ¹+0.5Ã—å£1)Ã—A1`, "");
      Log.add("1éš åœ°éœ‡å¿…è¦å£é‡", Math.ceil(req_lw1)+" cm/ã¡", "", "");
      
      this.results.W1 = W1_kN;
      this.results.W2 = 0;
      this.results.Ai2 = 1.0;
    }

    // 5. é¢¨åœ§åŠ›ã®æ¤œè¨
    const Cw = val('wind_coeff');
    const wx1_area = val('wind_aw_x1') + (stories===2 ? val('wind_aw_x2') : 0);
    const wy1_area = val('wind_aw_y1') + (stories===2 ? val('wind_aw_y2') : 0);
    const wx2_area = (stories===2) ? val('wind_aw_x2') : 0;
    const wy2_area = (stories===2) ? val('wind_aw_y2') : 0;
    
    // é¢¨åœ§å¿…è¦å£é‡ = è¦‹ä»˜é¢ç© Ã— é¢¨åœ§åŠ›ä¿‚æ•° (cmå˜ä½)
    const wx1 = wx1_area * Cw;
    const wy1 = wy1_area * Cw;
    const wx2 = wx2_area * Cw;
    const wy2 = wy2_area * Cw;
    
    Log.header("5. é¢¨åœ§åŠ›ã®æ¤œè¨");
    Log.add("é¢¨åœ§åŠ›ä¿‚æ•° Cw", Cw, "", "");
    Log.add("1éš Xæ–¹å‘ è¦‹ä»˜é¢ç©", wx1_area.toFixed(1)+"ã¡", stories===2?`${val('wind_aw_x1')}+${val('wind_aw_x2')}`:`${val('wind_aw_x1')}`, "");
    Log.add("1éš Xæ–¹å‘ é¢¨åœ§å¿…è¦å£é‡", wx1.toFixed(1)+" cm", `${wx1_area.toFixed(1)}Ã—${Cw}`, "è¦‹ä»˜é¢ç©Ã—ä¿‚æ•°(cm/ã¡)");
    Log.add("1éš Yæ–¹å‘ è¦‹ä»˜é¢ç©", wy1_area.toFixed(1)+"ã¡", stories===2?`${val('wind_aw_y1')}+${val('wind_aw_y2')}`:`${val('wind_aw_y1')}`, "");
    Log.add("1éš Yæ–¹å‘ é¢¨åœ§å¿…è¦å£é‡", wy1.toFixed(1)+" cm", `${wy1_area.toFixed(1)}Ã—${Cw}`, "è¦‹ä»˜é¢ç©Ã—ä¿‚æ•°(cm/ã¡)");
    if(stories===2) {
      Log.add("2éš Xæ–¹å‘ è¦‹ä»˜é¢ç©", wx2_area.toFixed(1)+"ã¡", `${val('wind_aw_x2')}`, "");
      Log.add("2éš Xæ–¹å‘ é¢¨åœ§å¿…è¦å£é‡", wx2.toFixed(1)+" cm", `${wx2_area.toFixed(1)}Ã—${Cw}`, "è¦‹ä»˜é¢ç©Ã—ä¿‚æ•°(cm/ã¡)");
      Log.add("2éš Yæ–¹å‘ è¦‹ä»˜é¢ç©", wy2_area.toFixed(1)+"ã¡", `${val('wind_aw_y2')}`, "");
      Log.add("2éš Yæ–¹å‘ é¢¨åœ§å¿…è¦å£é‡", wy2.toFixed(1)+" cm", `${wy2_area.toFixed(1)}Ã—${Cw}`, "è¦‹ä»˜é¢ç©Ã—ä¿‚æ•°(cm/ã¡)");
    }

    // 6. åœ°éœ‡ãƒ»é¢¨åœ§ã®æ¯”è¼ƒã¨æ±ºå®š
    // åœ°éœ‡å¿…è¦å£é‡(ç·é‡) = åˆ‡ã‚Šä¸Šã’ãŸå˜ä½å£é‡(cm/ã¡) Ã— åºŠé¢ç©
    const req_seismic_1 = Math.ceil(req_lw1) * area1;
    const req_seismic_2 = Math.ceil(req_lw2) * area2;
    
    Log.header("6. å¿…è¦å£é‡ã®æ±ºå®š (åœ°éœ‡ vs é¢¨åœ§)");
    
    // 1éš
    const decide_1x = Math.max(req_seismic_1, wx1);
    const decide_1y = Math.max(req_seismic_1, wy1);
    const gov_1x = (req_seismic_1 >= wx1) ? "åœ°éœ‡" : "é¢¨åœ§";
    const gov_1y = (req_seismic_1 >= wy1) ? "åœ°éœ‡" : "é¢¨åœ§";
    
    Log.add("1éš åœ°éœ‡å¿…è¦å£é‡(ç·é‡)", req_seismic_1.toFixed(0)+" cm", `${Math.ceil(req_lw1)} Ã— ${area1}`, "");
    Log.add("1éš Xæ–¹å‘ æ±ºå®š", Math.ceil(decide_1x)+" cm", `max(${req_seismic_1.toFixed(0)}, ${wx1.toFixed(1)})`, gov_1x+"ã§æ±ºå®š");
    Log.add("1éš Yæ–¹å‘ æ±ºå®š", Math.ceil(decide_1y)+" cm", `max(${req_seismic_1.toFixed(0)}, ${wy1.toFixed(1)})`, gov_1y+"ã§æ±ºå®š");
    
    this.results.req_1x = Math.ceil(decide_1x);
    this.results.req_1y = Math.ceil(decide_1y);
    
    // 2éš
    if(stories===2) {
      const decide_2x = Math.max(req_seismic_2, wx2);
      const decide_2y = Math.max(req_seismic_2, wy2);
      const gov_2x = (req_seismic_2 >= wx2) ? "åœ°éœ‡" : "é¢¨åœ§";
      const gov_2y = (req_seismic_2 >= wy2) ? "åœ°éœ‡" : "é¢¨åœ§";
      
      Log.add("2éš åœ°éœ‡å¿…è¦å£é‡(ç·é‡)", req_seismic_2.toFixed(0)+" cm", `${Math.ceil(req_lw2)} Ã— ${area2}`, "");
      Log.add("2éš Xæ–¹å‘ æ±ºå®š", Math.ceil(decide_2x)+" cm", `max(${req_seismic_2.toFixed(0)}, ${wx2.toFixed(1)})`, gov_2x+"ã§æ±ºå®š");
      Log.add("2éš Yæ–¹å‘ æ±ºå®š", Math.ceil(decide_2y)+" cm", `max(${req_seismic_2.toFixed(0)}, ${wy2.toFixed(1)})`, gov_2y+"ã§æ±ºå®š");
      
      this.results.req_2x = Math.ceil(decide_2x);
      this.results.req_2y = Math.ceil(decide_2y);
    } else {
      this.results.req_2x = 0;
      this.results.req_2y = 0;
    }
    
    this.results.lw1 = Math.ceil(req_lw1);
    this.results.lw2 = Math.ceil(req_lw2);

    // Step 1 ç”»é¢è¡¨ç¤ºæ›´æ–° (cm/ã¡ã¨Î£W)
    txt('disp_lw1', Math.ceil(req_lw1));
    txt('disp_sw1', this.results.W1 ? this.results.W1.toFixed(2) : '-');
    if(stories===2) {
      txt('disp_lw2', Math.ceil(req_lw2));
      txt('disp_sw2', this.results.W2 ? this.results.W2.toFixed(2) : '-');
      txt('disp_ai2', Ai2.toFixed(3));
    } else {
      txt('disp_lw2', '-');
      txt('disp_sw2', '-');
      txt('disp_ai2', '-');
    }
    
    // æŸ±ã®æ–­é¢ç®—å®š
    this.calcColumnData(Gr, w_out2, w_in2, w_out1, w_in1, Ms);
    
    // WallCheckåŒæœŸ
    if(typeof WallCheck !== 'undefined' && WallCheck.initDone) {
      WallCheck.syncFromCalc();
    }
  },

  calcColumnData(Gr, w_out2, w_in2, w_out1, w_in1, Ms){
    const stories = parseInt(document.getElementById('stories').value);
    const floor = parseInt(document.getElementById('col_floor').value);
    const pos = document.getElementById('col_pos').value;
    const Ae = val('col_ae');
    const usage = document.getElementById('usage').value;

    const w_w2 = (pos==='outer') ? (w_out2 + w_in2) : w_in2;
    const w_w1 = (pos==='outer') ? (w_out1 + w_in1) : w_in1;
    
    // Column Floor Load (Live+Dead) - differs from Seismic
    const w_floor_col = (usage==='res') ? (610+1300) : (610+1800);

    Log.header("7. æŸ±ã®å°å¾„ç®—å®š (é•·æœŸè·é‡)");
    let Wd = 0;
    let formula_str = "";
    
    if(stories===2){
       if(floor===2){
         // 2F Column
         Wd = Gr + Ms + 0.5 * w_w2;
         formula_str = (pos==='outer') ? "Gr+Ms + 0.5Ã—(å¤–å£+å†…å£)" : "Gr+Ms + 0.5Ã—å†…å£";
         Log.add("è² æ‹…è·é‡ Wd", Wd.toFixed(1)+" N/ã¡", formula_str, "å±‹æ ¹+ç©é›ª+2éšå£åŠ");
         if(pos==='outer') Log.add("â€»å£è·é‡è©³ç´°", (w_w2).toFixed(1), `${w_out2.toFixed(1)}(å¤–)+${w_in2.toFixed(1)}(å†…)`, "å¤–å‘¨æŸ±ã¯å†…å£åˆ†ã‚‚åŠ ç®—");
       } else {
         // 1F Column
         Wd = Gr + Ms + w_w2 + w_floor_col + 0.5 * w_w1;
         formula_str = (pos==='outer') ? "Gr+Ms + (å¤–2+å†…2) + åºŠ + 0.5Ã—(å¤–1+å†…1)" : "Gr+Ms + å†…2 + åºŠ + 0.5Ã—å†…1";
         Log.add("åºŠè·é‡(æŸ±ç”¨)", w_floor_col, "DL(610) + LL(1300/1800)", "é•·æœŸè·é‡ç”¨");
         Log.add("è² æ‹…è·é‡ Wd", Wd.toFixed(1)+" N/ã¡", formula_str, "å±‹æ ¹+å£2+åºŠ+å£1åŠ");
       }
    } else {
       // 1F Column (1-Story)
       Wd = Gr + Ms + 0.5 * w_w1;
       formula_str = (pos==='outer') ? "Gr+Ms + 0.5Ã—(å¤–å£+å†…å£)" : "Gr+Ms + 0.5Ã—å†…å£";
       Log.add("è² æ‹…è·é‡ Wd", Wd.toFixed(1)+" N/ã¡", formula_str, "å±‹æ ¹+ç©é›ª+1éšå£åŠ");
    }

    txt('chk_wd', Wd.toFixed(0));
    const N_act = Wd * Ae;
    txt('chk_n_act', (N_act/1000).toFixed(2));
    Log.add("ç™ºç”Ÿè»¸åŠ› N", (N_act/1000).toFixed(2)+" kN", `${Wd.toFixed(0)}N/ã¡ Ã— ${Ae}ã¡`, "è² æ‹…é¢ç©");
    
    // Strength Check
    const h_curr = (floor===2 && stories===2) ? val('h2') : val('h1');
    
    // FIX: 1F lk calculation logic (minus 120 for 1F, minus 105 for 2F)
    const sub_val = (floor === 1) ? 120 : 105;
    const lk = Math.max(0, h_curr * 1000 - sub_val);
    
    const w_min = val('col_w_min');
    const w_max = val('col_w_max');
    const short = Math.min(w_min, w_max);
    
    const i = short / Math.sqrt(12);
    const lambda = lk / i;
    txt('chk_lambda', lambda.toFixed(1));
    Log.add("æœ‰åŠ¹ç´°é•·æ¯” Î»", lambda.toFixed(1), `lk(${lk}) / i(${i.toFixed(1)})`, `lk=éšé«˜-${sub_val}`);
    
    const Fc = parseFloat(document.getElementById('mat_grade').value) || 0;
    txt('disp_fc', Fc);
    
    let Kd = 1.0;
    let kd_formula = "";
    if(lambda <= 30) { Kd = 1.0; kd_formula="Î»â‰¦30 â†’ 1.0"; }
    else if(lambda <= 100) { Kd = 1.3 - 0.01 * lambda; kd_formula="1.3 - 0.01Î»"; }
    else { Kd = 3000 / (lambda * lambda); kd_formula="3000 / Î»Â²"; }
    
    Log.add("åº§å±ˆä¿‚æ•° Kd", Kd.toFixed(3), kd_formula, (lambda>100)?"ã‚ªã‚¤ãƒ©ãƒ¼åº§å±ˆ":"ç›´ç·šä½æ¸›");
    
    // FIX: fk Formula (1.1 / 3 * Fc * Kd)
    const fk = (1.1 * Fc / 3) * Kd;
    
    txt('chk_fk', fk.toFixed(2));
    Log.add("é•·æœŸè¨±å®¹å¿œåŠ›åº¦ fk", fk.toFixed(2)+" N/ãŸ", `1.1Ã—${Fc}/3 Ã— ${Kd.toFixed(3)}`, "1.1/3Ã—FcÃ—Kd");
    
    const N_allow = fk * w_min * w_max;
    txt('chk_n_allow', (N_allow/1000).toFixed(2));
    Log.add("è¨±å®¹è€åŠ› Na", (N_allow/1000).toFixed(2)+" kN", `${fk.toFixed(2)} Ã— ${w_min}Ã—${w_max}`, "fk Ã— æ–­é¢ç©");
    
    const elJ = document.getElementById('col_judge');
    const elM = document.getElementById('col_msg');
    
    if(lambda > 150){
      elJ.textContent = "NG"; elJ.className = "res-val status-ng";
      elM.textContent = "æœ‰åŠ¹ç´°é•·æ¯” 150è¶…";
    } else if(N_act <= N_allow){
      elJ.textContent = "OK"; elJ.className = "res-val status-ok";
      elM.textContent = `æ¤œå®šæ¯” ${((N_act/N_allow)*100).toFixed(0)}%`;
    } else {
      elJ.textContent = "NG"; elJ.className = "res-val status-ng";
      elM.textContent = "è¨±å®¹è€åŠ›ä¸è¶³";
    }
    Log.render();
  }
};

/* ===== Feature B: N-Calc (Pro Version) ===== */


/* ===== Feature D: Wall Check & 4-Split ===== */
const WallCheck = {
  initDone: false,
  // å››åˆ†å‰²æ³•é¸æŠçŠ¶æ…‹ã‚’ä¿æŒ
  selected4Div: {
    x_1f_t: {}, x_1f_b: {}, y_1f_l: {}, y_1f_r: {},
    x_2f_t: {}, x_2f_b: {}, y_2f_l: {}, y_2f_r: {}
  },
  
  toggleWind() {
    const isChecked = document.getElementById('chk_wind_check').checked;
    document.getElementById('pnl_wind_check').style.display = isChecked ? 'block' : 'none';
    Calc.exec();
    this.recalcFloor('1f');
    this.recalcFloor('2f');
  },
  
  toggle4Div() {
    const isChecked = document.getElementById('chk_4div_check').checked;
    document.getElementById('pnl_4div_explain').style.display = isChecked ? 'block' : 'none';
    ['x_1f', 'y_1f', 'x_2f', 'y_2f'].forEach(id => {
      const el = document.getElementById('pnl_4div_' + id);
      if(el) el.style.display = isChecked ? 'block' : 'none';
    });
  },
  
  addRow(axis, floor, data) {
    const table = document.getElementById(`wc_table_${axis}_${floor}`).getElementsByTagName('tbody')[0];
    const prefix = axis.toUpperCase();
    const nextNum = table.rows.length + 1;
    const tr = document.createElement('tr');
    const rowId = `${axis}_${floor}_${Date.now()}_${nextNum}`;
    tr.dataset.rowId = rowId;
    const d = data || {name: prefix+nextNum, spec:'', ratio:0, len:0.91, count:1};
    tr.innerHTML = `<td><input type="text" class="wc_rowname" value="${d.name}" style="width:100%;"></td>
      <td><div style="display:flex;"><input type="text" class="wc_name" value="${d.spec}" style="width:100%;font-size:0.8rem;"><button class="select-btn" onclick="WallCheck.openModal(this)">é¸æŠ</button></div></td>
      <td><input type="number" class="wc_ratio" value="${d.ratio}" step="0.1" oninput="WallCheck.rowUpdate(this,'${floor}')" style="width:100%;text-align:center;"></td>
      <td><input type="number" class="wc_len" value="${d.len}" step="0.01" oninput="WallCheck.rowUpdate(this,'${floor}')" style="width:100%;"></td>
      <td><input type="number" class="wc_count" value="${d.count}" oninput="WallCheck.rowUpdate(this,'${floor}')" style="width:100%;text-align:center;"></td>
      <td><input type="number" class="wc_val" readonly value="0" style="width:100%;background:#f1f1f1;text-align:right;"></td>
      <td><button style="color:red;border:none;background:none;cursor:pointer;" onclick="WallCheck.delRow(this,'${floor}')">Ã—</button></td>`;
    table.appendChild(tr);
    this.rowUpdate(tr.querySelector('.wc_ratio'), floor);
  },
  rowUpdate(el, floor) {
    const tr = el.parentNode.parentNode;
    const r = parseFloat(tr.querySelector('.wc_ratio').value)||0;
    const l = parseFloat(tr.querySelector('.wc_len').value)||0;
    const c = parseFloat(tr.querySelector('.wc_count').value)||0;
    tr.querySelector('.wc_val').value = (r*l*c*100).toFixed(1);
    this.recalcFloor(floor);
  },
  delRow(btn, floor) { 
    const tr = btn.parentNode.parentNode;
    const rowId = tr.dataset.rowId;
    // å››åˆ†å‰²é¸æŠã‹ã‚‰å‰Šé™¤
    Object.keys(this.selected4Div).forEach(key => {
      if(this.selected4Div[key][rowId]) delete this.selected4Div[key][rowId];
    });
    tr.remove(); 
    this.recalcFloor(floor); 
  },
  
  // å››åˆ†å‰²æ³•ç”¨ï¼šé€šã‚Šãƒœã‚¿ãƒ³ã‚’æ›´æ–°
  update4DivButtons(floor) {
    const axes = ['x', 'y'];
    axes.forEach(ax => {
      const tb = document.getElementById(`wc_table_${ax}_${floor}`);
      const rows = tb.querySelectorAll('tbody tr');
      
      // Xæ–¹å‘: t(ä¸Šç«¯), b(ä¸‹ç«¯) / Yæ–¹å‘: l(å·¦ç«¯), r(å³ç«¯)
      const suffix1 = (ax === 'x') ? 't' : 'l';
      const suffix2 = (ax === 'x') ? 'b' : 'r';
      const container1 = document.getElementById(`wc_4sel_${ax}_${floor}_${suffix1}`);
      const container2 = document.getElementById(`wc_4sel_${ax}_${floor}_${suffix2}`);
      
      if(!container1 || !container2) return;
      container1.innerHTML = '';
      container2.innerHTML = '';
      
      rows.forEach(row => {
        const rowId = row.dataset.rowId;
        const rowName = row.querySelector('.wc_rowname').value;
        const wallVal = parseFloat(row.querySelector('.wc_val').value) || 0;
        
        // ãƒœã‚¿ãƒ³1 (ä¸Šç«¯/å·¦ç«¯ç”¨)
        const btn1 = document.createElement('button');
        btn1.type = 'button';
        btn1.className = 'zone-btn' + (this.selected4Div[`${ax}_${floor}_${suffix1}`][rowId] ? ' selected' : '');
        btn1.textContent = rowName;
        btn1.dataset.rowId = rowId;
        btn1.dataset.wallVal = wallVal;
        btn1.onclick = () => this.toggle4DivSelection(ax, floor, suffix1, rowId, wallVal, btn1);
        container1.appendChild(btn1);
        
        // ãƒœã‚¿ãƒ³2 (ä¸‹ç«¯/å³ç«¯ç”¨)
        const btn2 = document.createElement('button');
        btn2.type = 'button';
        btn2.className = 'zone-btn' + (this.selected4Div[`${ax}_${floor}_${suffix2}`][rowId] ? ' selected' : '');
        btn2.textContent = rowName;
        btn2.dataset.rowId = rowId;
        btn2.dataset.wallVal = wallVal;
        btn2.onclick = () => this.toggle4DivSelection(ax, floor, suffix2, rowId, wallVal, btn2);
        container2.appendChild(btn2);
        
        // é¸æŠæ¸ˆã¿è¡Œã®å£é‡å€¤ã‚’æ›´æ–°
        if(this.selected4Div[`${ax}_${floor}_${suffix1}`][rowId]) {
          this.selected4Div[`${ax}_${floor}_${suffix1}`][rowId] = wallVal;
        }
        if(this.selected4Div[`${ax}_${floor}_${suffix2}`][rowId]) {
          this.selected4Div[`${ax}_${floor}_${suffix2}`][rowId] = wallVal;
        }
      });
      
      this.calc4DivSum(ax, floor, suffix1);
      this.calc4DivSum(ax, floor, suffix2);
      this.recalc4DivCheck(ax, floor);
    });
  },
  
  toggle4DivSelection(ax, floor, suffix, rowId, wallVal, btn) {
    const key = `${ax}_${floor}_${suffix}`;
    if(this.selected4Div[key][rowId]) {
      delete this.selected4Div[key][rowId];
      btn.classList.remove('selected');
    } else {
      this.selected4Div[key][rowId] = wallVal;
      btn.classList.add('selected');
    }
    this.calc4DivSum(ax, floor, suffix);
    this.recalc4DivCheck(ax, floor);
  },
  
  calc4DivSum(ax, floor, suffix) {
    const key = `${ax}_${floor}_${suffix}`;
    let sum = 0;
    Object.values(this.selected4Div[key]).forEach(v => sum += v);
    const el = document.getElementById(`wc_4sum_${ax}_${floor}_${suffix}`);
    if(el) el.textContent = sum.toFixed(1);
  },
  
  recalc4DivCheck(ax, floor) {
    const suffix1 = (ax === 'x') ? 't' : 'l';
    const suffix2 = (ax === 'x') ? 'b' : 'r';
    const label1 = (ax === 'x') ? 'ä¸Šç«¯' : 'å·¦ç«¯';
    const label2 = (ax === 'x') ? 'ä¸‹ç«¯' : 'å³ç«¯';
    
    // å„ã‚¾ãƒ¼ãƒ³ã®1/4åºŠé¢ç©ã‚’å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰å–å¾—
    const areaEl1 = document.getElementById(`wc_4area_${ax}_${floor}_${suffix1}`);
    const areaEl2 = document.getElementById(`wc_4area_${ax}_${floor}_${suffix2}`);
    const area1 = areaEl1 ? (parseFloat(areaEl1.value) || 0) : 0;
    const area2 = areaEl2 ? (parseFloat(areaEl2.value) || 0) : 0;
    
    // å¿…è¦å£é‡(cm/ã¡)ã‚’å–å¾—
    const lw = (floor === '1f') ? (Calc.results.lw1 || 0) : (Calc.results.lw2 || 0);
    
    // å„ã‚¾ãƒ¼ãƒ³ã®å¿…è¦å£é‡ = å¿…è¦å£é‡(cm/ã¡) Ã— 1/4åºŠé¢ç©
    const sideReq1 = Math.ceil(lw) * area1;
    const sideReq2 = Math.ceil(lw) * area2;
    
    // å¿…è¦å£é‡ã®è¡¨ç¤ºã‚’æ›´æ–°
    const reqEl1 = document.getElementById(`wc_4req_${ax}_${floor}_${suffix1}`);
    const reqEl2 = document.getElementById(`wc_4req_${ax}_${floor}_${suffix2}`);
    if(reqEl1) reqEl1.textContent = sideReq1.toFixed(1);
    if(reqEl2) reqEl2.textContent = sideReq2.toFixed(1);
    
    // å„å´ç«¯éƒ¨åˆ†ã®å­˜åœ¨å£é‡ã‚’å–å¾—
    let exist1 = 0, exist2 = 0;
    Object.values(this.selected4Div[`${ax}_${floor}_${suffix1}`]).forEach(v => exist1 += v);
    Object.values(this.selected4Div[`${ax}_${floor}_${suffix2}`]).forEach(v => exist2 += v);
    
    // å£é‡å……è¶³ç‡ = å­˜åœ¨å£é‡ / å¿…è¦å£é‡
    const rate1 = (sideReq1 > 0) ? exist1 / sideReq1 : 0;
    const rate2 = (sideReq2 > 0) ? exist2 / sideReq2 : 0;
    
    const el1 = document.getElementById(`res_4bal_${ax}_${floor}_l`);
    const el2 = document.getElementById(`res_4bal_${ax}_${floor}_r`);
    
    if(!el1 || !el2) return;
    if(sideReq1 === 0 && sideReq2 === 0) { 
      el1.innerHTML = "-"; 
      el2.innerHTML = "-"; 
      return; 
    }
    
    // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼š
    // 1. å£é‡å……è¶³ç‡ > 1.0 ãªã‚‰ OK
    // 2. ã©ã¡ã‚‰ã‹ãŒ1.0ä»¥ä¸‹ã®å ´åˆã€å£ç‡æ¯” = å°ã•ã„æ–¹/å¤§ãã„æ–¹ >= 0.5 ãªã‚‰ OK
    
    const rateSmall = Math.min(rate1, rate2);
    const rateLarge = Math.max(rate1, rate2);
    const wallRatio = (rateLarge > 0) ? rateSmall / rateLarge : 0;
    
    // ä¸¡æ–¹ã¨ã‚‚å……è¶³ç‡ > 1.0 ã®å ´åˆ
    if(rate1 > 1.0 && rate2 > 1.0) {
      el1.innerHTML = `<span style="color:green;font-weight:bold;">OK</span><br><span style="font-size:0.85em;">å……è¶³ç‡: ${rate1.toFixed(2)}</span>`;
      el2.innerHTML = `<span style="color:green;font-weight:bold;">OK</span><br><span style="font-size:0.85em;">å……è¶³ç‡: ${rate2.toFixed(2)}</span>`;
    } 
    // ã©ã¡ã‚‰ã‹ãŒ1.0ä»¥ä¸‹ã®å ´åˆã€å£ç‡æ¯”ã§åˆ¤å®š
    else {
      const isOK = wallRatio >= 0.5;
      const statusColor = isOK ? 'green' : 'red';
      const statusText = isOK ? 'OK' : 'NG';
      
      // å„å´ç«¯ã®è¡¨ç¤º
      const makeResult = (rate, label, isSmaller) => {
        let html = `<span style="color:${rate > 1.0 ? 'green' : (isOK ? '#f39c12' : 'red')};font-weight:bold;">`;
        html += rate > 1.0 ? 'OK' : statusText;
        html += `</span><br>`;
        html += `<span style="font-size:0.85em;">å……è¶³ç‡: ${rate.toFixed(2)}</span>`;
        if(rate <= 1.0 || (rate1 <= 1.0 || rate2 <= 1.0)) {
          html += `<br><span style="font-size:0.8em;color:#666;">å£ç‡æ¯”: ${wallRatio.toFixed(2)}</span>`;
        }
        return html;
      };
      
      el1.innerHTML = makeResult(rate1, label1, rate1 <= rate2);
      el2.innerHTML = makeResult(rate2, label2, rate2 < rate1);
    }
  },
  
  recalcFloor(floor) {
    ['x','y'].forEach(ax => {
      const tb = document.getElementById(`wc_table_${ax}_${floor}`);
      let sum = 0;
      tb.querySelectorAll('.wc_val').forEach(i => sum += parseFloat(i.value)||0);
      document.getElementById(`wc_exist_${ax}_${floor}`).textContent = sum.toFixed(1);
      
      const req = parseFloat(document.getElementById(`wc_req_total_${ax}_${floor}`).value)||0;
      
      // å¿…è¦å£é‡è¡¨ç¤ºæ›´æ–°
      const reqDisp = document.getElementById(`wc_req_disp_${ax}_${floor}`);
      if(reqDisp) reqDisp.textContent = req.toFixed(0);
      
      const elJ = document.getElementById(`wc_judge_${ax}_${floor}`);
      if(sum >= req) { 
        elJ.textContent="OK"; 
        elJ.style.background="#27ae60"; 
        elJ.style.color="#fff";
      } else { 
        elJ.textContent="NG"; 
        elJ.style.background="#e74c3c"; 
        elJ.style.color="#fff";
      }
    });
    
    // å››åˆ†å‰²æ³•ãƒœã‚¿ãƒ³æ›´æ–°
    this.update4DivButtons(floor);
  },
  syncFromCalc() {
    // é¢¨åœ§åŠ›æ¤œè¨ã®æœ‰ç„¡ã‚’ç¢ºèª
    const windChecked = document.getElementById('chk_wind_check').checked;
    
    // åºŠé¢ç©ã‚’å–å¾—
    const area1 = parseFloat(document.getElementById('area1').value) || 0;
    const area2 = parseFloat(document.getElementById('area2').value) || 0;
    
    // 1/4åºŠé¢ç©ã®åˆæœŸå€¤ã‚’è¨­å®šï¼ˆåºŠé¢ç©ã®1/4ï¼‰
    const area1_quarter = (area1 / 4).toFixed(2);
    const area2_quarter = (area2 / 4).toFixed(2);
    
    // å„ã‚¾ãƒ¼ãƒ³ã®1/4åºŠé¢ç©å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°ï¼ˆæ‰‹å‹•å¤‰æ›´ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿åˆæœŸå€¤ã‚»ãƒƒãƒˆï¼‰
    // Xæ–¹å‘: t(ä¸Šç«¯), b(ä¸‹ç«¯) / Yæ–¹å‘: l(å·¦ç«¯), r(å³ç«¯)
    const zoneSuffixes = {
      'x': ['t', 'b'],
      'y': ['l', 'r']
    };
    
    ['x', 'y'].forEach(ax => {
      zoneSuffixes[ax].forEach(suffix => {
        const el1f = document.getElementById(`wc_4area_${ax}_1f_${suffix}`);
        const el2f = document.getElementById(`wc_4area_${ax}_2f_${suffix}`);
        // æ‰‹å‹•å¤‰æ›´ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿åˆæœŸå€¤ã‚’ã‚»ãƒƒãƒˆ
        if(el1f && (!el1f.dataset.userModified)) {
          el1f.value = area1_quarter;
        }
        if(el2f && (!el2f.dataset.userModified)) {
          el2f.value = area2_quarter;
        }
      });
    });
    
    if(windChecked) {
      document.getElementById('wc_req_total_x_1f').value = Calc.results.req_1x.toFixed(0);
      document.getElementById('wc_req_total_y_1f').value = Calc.results.req_1y.toFixed(0);
      document.getElementById('wc_req_total_x_2f').value = Calc.results.req_2x.toFixed(0);
      document.getElementById('wc_req_total_y_2f').value = Calc.results.req_2y.toFixed(0);
    } else {
      // é¢¨åœ§ãªã—ï¼šåœ°éœ‡ã®ã¿
      const lw1 = Calc.results.lw1 || 0;
      const lw2 = Calc.results.lw2 || 0;
      const seismic1 = Math.ceil(lw1) * area1;
      const seismic2 = Math.ceil(lw2) * area2;
      document.getElementById('wc_req_total_x_1f').value = seismic1.toFixed(0);
      document.getElementById('wc_req_total_y_1f').value = seismic1.toFixed(0);
      document.getElementById('wc_req_total_x_2f').value = seismic2.toFixed(0);
      document.getElementById('wc_req_total_y_2f').value = seismic2.toFixed(0);
    }
    this.recalcFloor('1f'); this.recalcFloor('2f');
  },
  // Modal (Same logic)
  targetRow:null,
  openModal(btn){ this.targetRow=btn.parentNode.parentNode.parentNode; document.getElementById('specModal').style.display='block'; document.getElementById('modal-step1').style.display='block'; document.getElementById('modal-step2').style.display='none'; },
  closeModal(e){ if(e.target.id==='specModal') document.getElementById('specModal').style.display='none'; },
  showCategory(type){
     let title = "";
     let data = [];

     if (type === 'okabe') {
       title = "ã€å¤§å£ä»•æ§˜ã€‘ä¸€è¦§";
       data = SPEC_DATA_OKABE;
     } else if (type === 'okabe_floor') {
       title = "ã€å¤§å£åºŠå‹ã¡ä»•æ§˜ã€‘ä¸€è¦§";
       data = SPEC_DATA_OKABE_FLOOR;
     } else if (type === 'uke') {
       title = "ã€å—æä»•æ§˜ï¼ˆçœŸå£ãƒ»çœŸå£åºŠå‹ã¡ï¼‰ã€‘ä¸€è¦§";
       data = SPEC_DATA_UKE;
     } else if (type === 'sujikai') {
       title = "ã€ç­‹äº¤ã„ç­‰ã€‘ä¸€è¦§";
       data = SPEC_DATA_SUJIKAI;
     }

     document.getElementById('modal-cat-title').textContent = title;
     
     // å‚è€ƒç”»åƒã®è¨­å®š
     const imgEl = document.getElementById('modal-ref-image');
     const imgBox = imgEl.parentNode;
     let imgSrc = "";
     if (type === 'okabe') {
       imgSrc = "oukabe.png";
     } else if (type === 'okabe_floor') {
       imgSrc = "oukabe_yuka.png";
     } else if (type === 'uke') {
       imgSrc = "shinkabe.png";
     } else if (type === 'sujikai') {
       imgSrc = "sujikai.png";
     }
     
     if(imgSrc) {
       imgEl.src = imgSrc;
       imgBox.style.display = 'block';
     } else {
       imgBox.style.display = 'none';
     }
     
     const tb=document.getElementById('modal-target-table').getElementsByTagName('tbody')[0]; 
     tb.innerHTML='';
     data.forEach(d=>{
        const tr=document.createElement('tr'); 
        tr.innerHTML=`
          <td style="text-align:left;">${d.name}${d.note ? `<div style="font-size:0.75em;color:#666;">${d.note}</div>` : ''}</td>
          <td style="text-align:center">${d.nail}</td>
          <td style="text-align:center">${d.p1}</td>
          <td style="text-align:center">${d.p2}</td>
          <td style="text-align:center;font-weight:bold;color:#3498db;font-size:1.1em;">${d.ratio.toFixed(1)}</td>
        `;
        tr.onclick=()=>{ 
           this.targetRow.querySelector('.wc_name').value=d.name; 
           const r=this.targetRow.querySelector('.wc_ratio'); 
           r.value=d.ratio; 
           r.oninput();
           document.getElementById('specModal').style.display='none';
        };
        tb.appendChild(tr);
     });
     document.getElementById('modal-step1').style.display='none'; 
     document.getElementById('modal-step2').style.display='block';
  },
  backStep1(){ document.getElementById('modal-step2').style.display='none'; document.getElementById('modal-step1').style.display='block'; }
};

/* ===== Init ===== */
Mat.init();
const UI = { update:()=>{ 
   const is2F=(document.getElementById('stories').value==='2'); 
   document.getElementById('grp_h2').style.display=is2F?'block':'none';
   document.getElementById('grp_area2').style.display=is2F?'block':'none';
   const windPanel = document.getElementById('grp_wind_2f');
   if(windPanel) windPanel.style.display=is2F?'grid':'none';
   document.getElementById('res_card_2f').style.display=is2F?'block':'none';
   document.getElementById('wc_area_2f').style.display=is2F?'block':'none';
   document.getElementById('opt_col_2f').disabled=!is2F;
}, toggle:(type)=>{
   if(type === 'snow') {
      const isSnow = document.getElementById('is_heavy_snow').value === 'yes';
      document.getElementById('pnl_snow').style.display = isSnow ? 'grid' : 'none';
   }
} };
UI.update();
window.onload = function(){
  WallCheck.initDone = true;
  
  // 1éš Xæ–¹å‘ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
  WallCheck.addRow('x','1f', {name:'X1', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:2});
  WallCheck.addRow('x','1f', {name:'X2', spec:'æ§‹é€ ç”¨åˆæ¿ 12mm', ratio:4.0, len:0.91, count:2});
  WallCheck.addRow('x','1f', {name:'X3', spec:'ç­‹ã‹ã„45Ã—90ãŸã™ã', ratio:4.0, len:0.91, count:1});
  WallCheck.addRow('x','1f', {name:'X4', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:2});
  WallCheck.addRow('x','1f', {name:'X5', spec:'ç­‹ã‹ã„45Ã—90ç‰‡å…¥ã‚Œ', ratio:2.0, len:0.91, count:2});
  WallCheck.addRow('x','1f', {name:'X6', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:2});
  
  // 1éš Yæ–¹å‘ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
  WallCheck.addRow('y','1f', {name:'Y1', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:2});
  WallCheck.addRow('y','1f', {name:'Y2', spec:'æ§‹é€ ç”¨åˆæ¿ 12mm', ratio:4.0, len:0.91, count:2});
  WallCheck.addRow('y','1f', {name:'Y3', spec:'ç­‹ã‹ã„45Ã—90ãŸã™ã', ratio:4.0, len:0.91, count:1});
  WallCheck.addRow('y','1f', {name:'Y4', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:2});
  WallCheck.addRow('y','1f', {name:'Y5', spec:'ç­‹ã‹ã„45Ã—90ç‰‡å…¥ã‚Œ', ratio:2.0, len:0.91, count:2});
  WallCheck.addRow('y','1f', {name:'Y6', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:2});
  
  // 2éšãŒã‚ã‚‹å ´åˆã®ã¿ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ 
  if(document.getElementById('stories').value === '2') { 
    WallCheck.addRow('x','2f', {name:'X1', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:1}); 
    WallCheck.addRow('x','2f', {name:'X2', spec:'æ§‹é€ ç”¨åˆæ¿ 12mm', ratio:4.0, len:0.91, count:1}); 
    WallCheck.addRow('x','2f', {name:'X3', spec:'ç­‹ã‹ã„30Ã—90ãŸã™ã', ratio:3.0, len:0.91, count:1}); 
    WallCheck.addRow('x','2f', {name:'X4', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:1}); 
    WallCheck.addRow('x','2f', {name:'X5', spec:'ç­‹ã‹ã„30Ã—90ç‰‡å…¥ã‚Œ', ratio:1.5, len:0.91, count:2}); 
    WallCheck.addRow('x','2f', {name:'X6', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:1}); 
    
    WallCheck.addRow('y','2f', {name:'Y1', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:1}); 
    WallCheck.addRow('y','2f', {name:'Y2', spec:'æ§‹é€ ç”¨åˆæ¿ 12mm', ratio:4.0, len:0.91, count:1}); 
    WallCheck.addRow('y','2f', {name:'Y3', spec:'ç­‹ã‹ã„30Ã—90ãŸã™ã', ratio:3.0, len:0.91, count:1}); 
    WallCheck.addRow('y','2f', {name:'Y4', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:1}); 
    WallCheck.addRow('y','2f', {name:'Y5', spec:'ç­‹ã‹ã„30Ã—90ç‰‡å…¥ã‚Œ', ratio:1.5, len:0.91, count:2}); 
    WallCheck.addRow('y','2f', {name:'Y6', spec:'æ§‹é€ ç”¨åˆæ¿ 9mm', ratio:3.7, len:0.91, count:1}); 
  }
  
  // å‰Šé™¤: NCalcé–¢é€£ã®è¡Œï¼ˆNCalcãŒå­˜åœ¨ã—ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ï¼‰
  // if (typeof NCalc !== 'undefined') { ... } ã¨ã„ã†ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã‚‚è‰¯ã„ã§ã™ãŒã€
  // ç¾çŠ¶ã®ã‚³ãƒ¼ãƒ‰ã«ã¯NCalcè‡ªä½“ãŒå«ã¾ã‚Œã¦ã„ãªã„ãŸã‚å‰Šé™¤ãŒå®‰å…¨ã§ã™ã€‚

  Calc.exec();
  WallCheck.syncFromCalc();
};
</script>
</body>
</html>